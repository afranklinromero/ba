if (self.CavalryLogger) { CavalryLogger.start_js(["PBqpZ"]); }

__d("SphericalMediaCoreActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";a={turnOn:function(){return{namespace:b("SphericalMediaActionNamespaces").CORE,type:b("SphericalMediaActions").TURN_ON}},turnOff:function(){return{namespace:b("SphericalMediaActionNamespaces").CORE,type:b("SphericalMediaActions").TURN_OFF}},enableSpherical:function(){return{namespace:b("SphericalMediaActionNamespaces").CORE,type:b("SphericalMediaActions").ENABLE_SPHERICAL}},disableSpherical:function(){return{namespace:b("SphericalMediaActionNamespaces").CORE,type:b("SphericalMediaActions").DISABLE_SPHERICAL}}};e.exports=a}),null);
__d("SphericalMediaViewActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";e.exports={updateView:function(a){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_VIEW,data:a}},updateViewport:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_VIEWPORT,data:{yaw:a,pitch:c}}},updateFOV:function(a){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_FOV,data:{fov:a}}},updateYaw:function(a){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_YAW,data:{yaw:a}}},updateViewportAndFOV:function(a,c,d){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_VIEWPORT_AND_FOV,data:{yaw:a,pitch:c,fov:d}}},startAnimating:function(){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").START_ANIMATING}},stopAnimating:function(){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").STOP_ANIMATING}}}}),null);
__d("SphericalMediaController.react",["cx","Event","React","SphericalMediaConstants","SphericalPhotoPartialLimits","SphericalPhotoTypedConfig","SphericalViewportControl","SubscriptionsHandler","debounce","getElementRect","performanceNow","throttle"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("SphericalMediaConstants").GYRO_SLIP_FACTOR,j=b("SphericalMediaConstants").LOGGER_SIGNIFICANT_MOVEMENT_DEGREE,k=b("SphericalMediaConstants").LOGGER_SIGNIFICANT_MOVEMENT_MS,l=b("SphericalMediaConstants").RB_FRICTION,m=b("SphericalMediaConstants").RB_MAX_SPRING_DEGREE,n=b("SphericalMediaConstants").RB_MAX_STRETCH_X_DEGREE,o=b("SphericalMediaConstants").RB_MAX_STRETCH_Y_DEGREE,p=b("SphericalMediaConstants").RB_SPRING_FACTOR,q=b("SphericalMediaConstants").TILED_CUBE_TILE_CONTENT_SIZE,r=b("SphericalPhotoPartialLimits").makePartialLimits;c=babelHelpers.inherits(a,b("React").Component);h=c&&c.prototype;function a(a){__p&&__p();h.constructor.call(this,a),this.$3=0,this.$5=!1,this.onViewChange=function(){var a=this.__sphericalViewportControl;if(a&&!a.isUpdating()){var b=this.__getViewData(),c=a.getOrientation(),d=a.getVerticalFieldOfView();d=b.fov!==d||b.pitch!==c.y||b.yaw!==c.x;d&&(a.updateViewport(b.yaw,b.pitch,b.fov),this.$4=babelHelpers["extends"]({},b))}}.bind(this),this.$6=function(){if(!this.__viewport)return;var a=b("getElementRect")(this.__viewport);(a.left!==0||a.right!==0||a.top!==0||a.bottom!==0||a.height!==0||a.width!==0)&&(this.$1={x:a.left,y:a.top})}.bind(this),this.$2=new(b("SubscriptionsHandler"))(),this.$2.addSubscriptions(b("Event").listen(window,"resize",b("debounce")(this.$6)))}a.prototype.UNSAFE_componentWillReceiveProps=function(a){a.isActive!==this.props.isActive&&!a.isActive&&this.$7(),a.isActive&&((a.width!==this.props.width||a.height!==this.props.height)&&this.$8(a.width,a.height))};a.prototype.componentDidMount=function(){this.props.isActive&&this.$9()};a.prototype.shouldComponentUpdate=function(a){a=a.isActive&&!this.__sphericalViewportControl||a.width!==this.props.width||a.height!==this.props.height;return a};a.prototype.componentDidUpdate=function(){this.props.isActive&&!this.__sphericalViewportControl&&this.$9(),this.$6()};a.prototype.componentWillUnmount=function(){this.$7()};a.prototype.$9=function(){__p&&__p();var a;if(!this.__viewport)return;a=this.__viewport;var c=this.__getSphericalConfig(this.props);a=new(b("SphericalViewportControl"))(a,c,this.$10(),this.props.showNewPhotoRenderer);this.$4={fov:c.fieldOfView,pitch:c.initialPitch,yaw:c.initialHeading};this.$6();a.addListener("updateViewportBegin",this.__onUpdateViewportBegin);a.addListener("updateViewportMoveStart",this.__onUpdateViewportMoveStart);a.addListener("DOM/click",this.__onDOMClick);a.addListener("updateViewportEnd",function(a,b){this.__onUpdateViewportEnd(),this.$11()}.bind(this));a.addListener("initialViewportChange",this.__onInitialViewportChange);a.addListener("viewportChange",this.__onViewportChange);a.addListener("zoomStart",this.__onZoomStart);a.addListener("mouseEnter",this.__onMouseEnter);a.addListener("mouseMove",b("throttle")(this.__onMouseMove));this.props.showNewPhotoRenderer&&this.props.initialFov>179&&a.setInitialOrientation();this.__sphericalViewportControl=a;this.$8(this.props.width,this.props.height)};a.prototype.$7=function(){this.$2.release(),this.__sphericalViewportControl&&this.__sphericalViewportControl.destroy(),this.__sphericalViewportControl=null,this.$5=!0};a.prototype.$11=function(){__p&&__p();var a=b("performanceNow")();if(Math.abs(a-this.$3)<k)return;var c=this.$4;if(!c)return;var d=this.__getViewData(),e=d.yaw-c.yaw;c=d.pitch-c.pitch;e=Math.sqrt(Math.pow(e,2)+Math.pow(c,2));j<e&&(this.__onSignificantMove(d),this.$3=a,this.$4=babelHelpers["extends"]({},d))};a.prototype.$8=function(a,c,d){__p&&__p();d=this.__sphericalViewportControl;if(d){d.updateViewportClientSize({width:a,height:c});if(this.props.maxTileLevel>0){a=Math.pow(2,this.props.maxTileLevel);a=q*a/90;c=c/a/3;d.updateMinVFOV(c)}b("SphericalPhotoTypedConfig").enable_stereograph_renderer&&(d.updateMaxVFOV(160),d.updateMaxHFOV(200));a=this.__getViewData();d.setFieldOfView(a.fov);c=d.getVerticalFieldOfView();c!==a.fov&&this.__updateFOV(c)}};a.prototype.$10=function(){return{disableAutoClientSizeUpdate:!0,enableGyro:this.props.enableGyro,enableRubberBanding:this.props.enableRubberBanding,maxSpringDegrees:m,maxStretchXDegrees:n,maxStretchYDegrees:o,minVFOV:this.props.maxTileLevel,rubberBandConstant:l,slipFactor:i,springFactor:p,enableZoomWithShiftKey:!1,enablePanningWithRightMouse:!1}};a.prototype.__getSphericalConfig=function(a){var b=this.__getPartialLimits(a),c=a.initialYaw,d=a.initialPitch,e=a.initialFov;if(this.$5){var f=this.__getViewData();e=f.fov;d=f.pitch;c=f.yaw}return{initialHeading:c,initialPitch:d,fieldOfView:e,keyboardVelocityFactor:a.keyboardVelocityFactor,panningVelocityFactor:a.panningVelocityFactor,enableZoom:a.enableZoom,partialLimits:b||void 0}};a.prototype.__getPartialLimits=function(a){return a.partialLimits.partialLeftDegrees||a.partialLimits.partialRightDegrees||a.partialLimits.partialTopDegrees||a.partialLimits.partialBottomDegrees?r({partialLeftDegrees:a.partialLimits.partialLeftDegrees,partialRightDegrees:a.partialLimits.partialRightDegrees,partialTopDegrees:a.partialLimits.partialTopDegrees,partialBottomDegrees:a.partialLimits.partialBottomDegrees}):null};a.prototype.__getViewportMousePosition=function(a){if(!this.$1){this.$6();if(!this.$1)return null}return{x:(a.clientX||a.changedTouches[0].clientX)-this.$1.x,y:(a.clientY||a.changedTouches[0].clientY)-this.$1.y}};a.prototype.__changeCursorStyle=function(a){if(!this.__viewport)return;this.__viewport.style.cursor=a};a.prototype.render=function(){return b("React").createElement("div",{ref:function(a){return this.__viewport=a}.bind(this),className:"_5nxw _25i_"+(this.props.isActive?"":" hidden_elem"),tabIndex:0,"aria-label":this.props.caption})};e.exports=a}),null);
__d("SphericalMediaRenderer.react",["cx","BackgroundImage.react","DOM","React","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=babelHelpers.inherits(a,b("React").Component);h=c&&c.prototype;function a(a){h.constructor.call(this,a);this.$2=!1;this.$3=!1;if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var b in this.constructor.__subClassMethods)if(typeof this[b]!=="function")throw new Error('Must implement "'+b+'"')}a.prototype.UNSAFE_componentWillReceiveProps=function(a){if(!a.isActive&&this.sphericalRenderer){this.__destroy();return}};a.prototype.shouldComponentUpdate=function(a){return this.shouldRender};a.prototype.componentDidMount=function(){this.$4()};a.prototype.componentWillUnmount=function(){this.__destroy()};a.prototype.__destroy=function(){this.sphericalRenderer&&this.sphericalRenderer.destroy(),this.sphericalRenderer=null};a.prototype.$4=function(){__p&&__p();if(this.$2||!this.__isReadyToSetup()||!this.$1||this.$3)return;this.$3=!0;var a=this.__getCanvas();b("promiseDone")(this.__getRenderer(a),function(c){c.updateViewportDimensions(this.props.width,this.props.height),c.addListener("renderingError",function(a,b){return this.__onWebGlRenderFailed(a,b)}.bind(this)),c.addListener("renderingContextLost",function(){return this.__onWebGlContextLost()}.bind(this)),b("DOM").setContent(this.$1,a),this.sphericalRenderer=c,c.renderErrorCheck(),this.$3=!1,this.__onSetupDone(c)}.bind(this),function(a){this.$2=!0;this.$3=!1;this.__onWebGlInitFailed(a);return}.bind(this))};a.prototype.draw=function(a){if(!this.sphericalRenderer)return;var b=this.sphericalRenderer;if(!b)return;try{b.render(a),this.__afterDraw(b)}catch(b){this.__onWebGlRenderFailed(b,a);return}};a.prototype.componentDidUpdate=function(){if(!this.props.isActive)return;var a=this.sphericalRenderer;!a?this.$4():(a.updateViewportDimensions(this.props.width,this.props.height),this.draw(this.__getViewData()))};a.prototype.render=function(){var a;this.props.thumbnail&&(a=b("React").createElement(b("BackgroundImage.react"),{className:(!this.__showLoadingThumbnail()||this.props.isActive&&this.sphericalRenderer?"hidden_elem":"")+" _2vjf",src:this.props.thumbnail,width:this.props.width,height:this.props.height,backgroundSize:"cover"}));return b("React").createElement("div",{className:"_4trl"},b("React").createElement("div",{className:(!this.props.isActive||!this.sphericalRenderer?"hidden_elem":"")+" _4trl",ref:function(a){return this.$1=a}.bind(this)}),a)};e.exports=a}),null);
__d("SphericalMediaBaseStore",["ReduxThunk","redux"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("redux").applyMiddleware,h=b("redux").combineReducers,i=b("redux").compose,j=b("redux").createStore;function a(a){a===void 0&&(a=[]);a=g.apply(void 0,[b("ReduxThunk")].concat(a));var c=h(this.getReducers());this.$1=i(a)(j)(c)}a.prototype.getStore=function(){return this.$1};a.prototype.getReducers=function(){throw new Error("Implement _getReducers")};e.exports=a}),null);
__d("SphericalMediaViewReducer",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={fov:65,pitch:0,yaw:0,isAnimating:!1,centeredYaw:0};a=function(a,c){__p&&__p();a===void 0&&(a=g);if(c.namespace!==b("SphericalMediaActionNamespaces").VIEW)return a;var d={};switch(c.type){case b("SphericalMediaActions").UPDATE_VIEW:d=c.data;d.centeredYaw=c.data.yaw;break;case b("SphericalMediaActions").UPDATE_VIEWPORT_AND_FOV:var e=c.data,f=e.pitch,h=e.fov;e=e.yaw;isNaN(f+h+e)||(d.fov=h,d.pitch=f,d.yaw=e,d.centeredYaw=e);break;case b("SphericalMediaActions").UPDATE_VIEWPORT:d.pitch=c.data.pitch;d.yaw=c.data.yaw;d.centeredYaw=c.data.yaw;break;case b("SphericalMediaActions").UPDATE_FOV:d.fov=c.data.fov;break;case b("SphericalMediaActions").UPDATE_YAW:d.yaw=c.data.yaw;break;case b("SphericalMediaActions").START_ANIMATING:d.isAnimating=!0;break;case b("SphericalMediaActions").STOP_ANIMATING:d.isAnimating=!1;break}return babelHelpers["extends"]({},a,d)};e.exports=a}),null);
__d("SphericalMediaViewStore",["SphericalMediaBaseStore","SphericalMediaViewReducer"],(function(a,b,c,d,e,f){"use strict";var g;g=babelHelpers.inherits(a,b("SphericalMediaBaseStore"));g&&g.prototype;a.prototype.getReducers=function(){return{view:b("SphericalMediaViewReducer")}};function a(){g.apply(this,arguments)}e.exports=a}),null);
__d("SphericalMediaBaseRecord",["PhotoProjection","immutable","SphericalMediaViewStore","SphericalPhotoPartialLimits"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=b("PhotoProjection").CUBESTRIP;d=b("SphericalPhotoPartialLimits").makePartialLimits;f=b("immutable").Record({keyboardVelocityFactor:0,panningVelocityFactor:0,enableGyro:!1,enablePartialLimit:!1,enableRubberBanding:!1,enableZoom:!1,showFallbackUI:!1,useFallbackUI:!1,useLargeHeadingIndicator:!1,useLargeVolumeIcon:!1,partialLimits:d({partialLeftDegrees:void 0,partialRightDegrees:void 0,partialTopDegrees:void 0,partialBottomDegrees:void 0}),isPanning:!1,hasInteracted:!1,visibility:!0,aspectRatio:1,height:0,width:0,initialFov:65,initialPitch:0,initialYaw:0,renderer:null,isRendererActive:!1,isRendererSetup:!1,className:"",projectionType:c,expansionCoef:void 0,tiledSphericalConfig:{useTiledRenderer:!1,initialTileUris:[],viewportTileUris:[],maxTileLevel:0},canvasNamespace:"SphericalMedia",caption:"",type:"photo",src:"",flatImage:"",originalImageURI:"",thumbnail:"",fbid:"",loaded:!1,enableSpherical:!0,isFetchingData:!1,photoSphereMetadata:{},exif:{},useLocalSphericalImage:!1,fallback:null,fallbackCTAElement:null,enableTagging:!1,tags:[],tagUnderMouse:null,tagClicked:null,isTagging:!1,tagger:null,taggingMode:!1,targetedTag:null,sourceProjectionType:null,surface:"",sessionID:"",viewStore:new(b("SphericalMediaViewStore"))().getStore(),ctrElement:null,ambientAudio:[],feedRootElement:null,vrDevice:null,vrIsPresenting:!1,vrRenderingSupported:!1,vrRendererIsReady:!1,fullscreenCubeImageURI:null});g=babelHelpers.inherits(a,f);g&&g.prototype;function a(){g.apply(this,arguments)}e.exports=a}),null);
__d("SphericalMediaBaseReducer",["PhotoRendererProjection","SphericalMediaActionNamespaces","SphericalMediaActions","SphericalMediaBaseRecord","SphericalMediaViewStore","SphericalPhotoPartialLimits"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalPhotoPartialLimits").makePartialLimits,h=function(){return new(b("SphericalMediaBaseRecord"))({viewStore:new(b("SphericalMediaViewStore"))().getStore()})};a=function(a,c){__p&&__p();a===void 0&&(a=h());if(c.namespace!==b("SphericalMediaActionNamespaces").CORE&&c.namespace!==b("SphericalMediaActionNamespaces").BASE)return a;switch(c.type){case b("SphericalMediaActions").UPDATE_BASE:var d=c.data;return a.withMutations(function(a){a.merge(d),d.photoSphereMetadata&&a.set("photoSphereMetadata",d.photoSphereMetadata),d.tiledSphericalConfig&&a.set("tiledSphericalConfig",d.tiledSphericalConfig),d.tags&&a.set("tags",d.tags),d.tagUnderMouse&&a.set("tagUnderMouse",d.tagUnderMouse),d.tagClicked&&a.set("tagClicked",d.tagClicked),d.tagger&&a.set("tagger",d.tagger),d.exif&&a.set("exif",d.exif),d.fallback&&a.set("fallback",d.fallback),d.ambientAudio&&a.set("ambientAudio",d.ambientAudio)});case b("SphericalMediaActions").DRAG_START:return a.withMutations(function(a){a.set("isPanning",!0),a.set("hasInteracted",!0)});case b("SphericalMediaActions").VISIBILITY_CHANGED:return a.set("visibility",c.data);case b("SphericalMediaActions").UPDATE_INITIAL_FOV:return a.set("initialFov",c.data.initialFov);case b("SphericalMediaActions").UPDATE_INITIAL_VIEWPORT:var e=c.data;return a.withMutations(function(a){a.set("initialYaw",e.initialYaw),a.set("initialPitch",e.initialPitch)});case b("SphericalMediaActions").UPDATE_DIMENSION:var f=c.data;return a.withMutations(function(a){a.set("height",f.height),a.set("width",f.width),a.set("aspectRatio",f.width/f.height)});case b("SphericalMediaActions").SETUP_RENDERER:var i=c.data.renderer;return a.withMutations(function(a){a.set("isRendererSetup",!0),a.set("renderer",i)});case b("SphericalMediaActions").TURN_ON:return a.set("isRendererActive",!0);case b("SphericalMediaActions").TURN_OFF:return a.withMutations(function(a){a.set("isRendererActive",!1),a.set("isRendererSetup",!1),a.set("renderer",null)});case b("SphericalMediaActions").REPLACE_BASE_STATE:return c.data;case b("SphericalMediaActions").SOURCE_ONLOAD:return a.set("loaded",!0);case b("SphericalMediaActions").DISABLE_SPHERICAL:return a.set("enableSpherical",!1);case b("SphericalMediaActions").ENABLE_SPHERICAL:return a.set("enableSpherical",!0);case b("SphericalMediaActions").REQUEST_PHOTO:return a.withMutations(function(a){a.set("loaded",!1),a.set("isFetchingData",!0)});case b("SphericalMediaActions").RECEIVE_PHOTO:var j=c.data,k=j.partialLimits,l=j.photoSphereMetadata||{};return a.withMutations(function(a){a.set("fbid",j.photoID),a.set("flatImage",j.flatImage),a.set("initialFov",j.initialFov),a.set("initialPitch",j.initialPitch),a.set("initialYaw",j.initialYaw),a.set("isFetchingData",!1),a.set("originalImageURI",j.originalImageURI),a.set("partialLimits",g({partialLeftDegrees:k.partialLeftDegrees,partialRightDegrees:k.partialRightDegrees,partialTopDegrees:k.partialTopDegrees,partialBottomDegrees:k.partialBottomDegrees})),a.set("sourceProjectionType",l.ProjectionType),a.set("src",j.src),a.set("thumbnail",j.thumbnail),a.set("photoSphereMetadata",l),a.set("tiledSphericalConfig",j.tiledSphericalConfig),l&&(l.RendererProjectionType===b("PhotoRendererProjection").CYLINDRICAL||l.RendererProjectionType===b("PhotoRendererProjection").EQUIRECTANGULAR)&&a.set("enableSpherical",!1)});case b("SphericalMediaActions").UPDATE_CTR_ELEM:return a.set("ctrElement",c.data.element);case b("SphericalMediaActions").ENABLE_TAGGING:return a.set("enableTagging",!0);case b("SphericalMediaActions").DISABLE_TAGGING:return a.set("enableTagging",!1);case b("SphericalMediaActions").UPDATE_SPATIAL_TAGS_FROM_COMPOSER:case b("SphericalMediaActions").UPDATE_SPATIAL_TAGS:var m=c.data;return a.withMutations(function(a){a.set("tags",m)});case b("SphericalMediaActions").UPDATE_TAG_UNDER_MOUSE:var n=c.data;return a.withMutations(function(a){a.set("tagUnderMouse",n)});case b("SphericalMediaActions").SET_VR_IS_PRESENTING:var o=c.data;return a.withMutations(function(a){a.set("vrIsPresenting",o)});case b("SphericalMediaActions").SET_VR_DEVICE:var p=c.data;return a.withMutations(function(a){a.set("vrDevice",p)});case b("SphericalMediaActions").SET_VR_RENDERING_SUPPORTED:var q=c.data;return a.withMutations(function(a){a.set("vrRenderingSupported",q)});case b("SphericalMediaActions").SET_VR_RENDERER_IS_READY:var r=c.data;return a.withMutations(function(a){a.set("vrRendererIsReady",r)});case b("SphericalMediaActions").CANVAS_RESIZE_SUCCESS:var s=c.data;return a.withMutations(function(a){a.set("src",s)});case b("SphericalMediaActions").TAGGING_START:return a.set("isTagging",!0);case b("SphericalMediaActions").TAGGING_STOP:return a.set("isTagging",!1);case b("SphericalMediaActions").UPDATE_TAG_CLICKED:var t=c.data;return a.withMutations(function(a){a.set("tagClicked",t)});case b("SphericalMediaActions").UPDATE_TAGGER:var u=c.data;return a.withMutations(function(a){a.set("tagger",u)});case b("SphericalMediaActions").ENTER_TAGGING_MODE:return a.set("taggingMode",!0);case b("SphericalMediaActions").EXIT_TAGGING_MODE:return a.set("taggingMode",!1);case b("SphericalMediaActions").UPDATE_TARGETED_TAG:var v=c.data;return a.withMutations(function(a){a.set("targetedTag",v)});case b("SphericalMediaActions").SHOW_FALLBACK:return a.set("showFallbackUI",!0);case b("SphericalMediaActions").USE_FALLBACK:return a.withMutations(function(a){a.set("useFallbackUI",!0),a.set("enableRubberBanding",!1)});case b("SphericalMediaActions").UPDATE_FEED_ROOT_ELEMENT:return a.set("feedRootElement",c.data);case b("SphericalMediaActions").UPDATE_PARTIAL_LIMITS:var w=c.data;return a.withMutations(function(a){a.set("partialLimits",g({partialLeftDegrees:w.partialLeftDegrees,partialRightDegrees:w.partialRightDegrees,partialTopDegrees:w.partialTopDegrees,partialBottomDegrees:w.partialBottomDegrees}))})}return a};e.exports=a}),null);
__d("SphericalPhotoActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";e.exports={rendererStats:function(a){return{namespace:b("SphericalMediaActionNamespaces").PHOTO,type:b("SphericalMediaActions").PHOTO_RENDERER_STATS,data:a}}}}),null);
__d("SphericalProjectionUtils",["invariant","degToRad","gl-matrix","radToDeg"],(function(a,b,c,d,e,f,g){__p&&__p();var h=b("gl-matrix").vec3,i=b("gl-matrix").mat4,j=Math.acos,k=Math.sin,l=Math.cos,m=15,n=.2,o={convert3dTo2dNormalized:function(a,c,d,e,f,g,j){__p&&__p();a=b("degToRad")(a);c=b("degToRad")(c);d=b("degToRad")(d);e=b("degToRad")(e);f=b("degToRad")(f);var k=i.create();i.perspective(k,f,g/j,.1,100);f=i.create();i.rotateX(f,f,c);i.rotateY(f,f,a);i.invert(f,f);g=i.create();i.rotateX(g,g,e);i.rotateY(g,g,d);i.multiply(g,g,f);i.multiply(g,k,g);j=h.fromValues(0,0,-1);h.transformMat4(j,j,g);c=.5+j[0]/2;a=.5+j[1]/2;return{x:c,y:a,isNegativeTwin:j[2]>1}},convert3dTo2dScaled:function(a,b,c,d,e,f,g){var h=o.convert3dTo2dNormalized.apply(o,arguments),i=h.x,j=h.y,k=h.isNegativeTwin;return{x:i*f,y:j*g,isNegativeTwin:k}},convert3dTo2dScaledUnique:function(a,b,c,d,e,f,g){var h=o.convert3dTo2dNormalized.apply(o,arguments),i=h.x,j=h.y,k=h.isNegativeTwin;k?i=j=-1:(i*=f,j*=g);return{x:i,y:j}},convert3dTo2dOnScreen:function(a,b,c,d,e,f,g){var h=o.convert3dTo2dScaled.apply(o,arguments),i=h.x,j=h.y,k=h.isNegativeTwin;k&&(i=-i,j=b>0?-g:g);i=Math.max(0,Math.min(f,i));j=Math.max(0,Math.min(g,j));return{x:i,y:j}},convert2dTo3dNormalized:function(a,c,d,e,f,h,j){__p&&__p();a<=1&&a>=-1||g(0,5706);c<=1&&c>=-1||g(0,5707);var k=b("degToRad")(d),l=b("degToRad")(e);f=b("degToRad")(f);var p=i.create();i.perspective(p,f,h/j,.1,100);h=-a/p[0];j=-c/p[5];a=k;c=l;p=Math.atan(Math.tan(f/2)*p[5]/p[0]);p=a+(h<0?p:-p);f=c+(j>0?f/2:-f/2);var q,r,s,t,u;t=u=q=0;while(q<m&&!(Math.abs(b("radToDeg")(p-a))<n&&Math.abs(b("radToDeg")(f-c))<n)){q++;r=(a+p)/2;s=(c+f)/2;var v=o._getRelativePositionWithoutProjection(k,l,r,s),w=v.x;v=v.y;(j-u)*(j-v)<=0?f=s:(c=s,u=v);(h-t)*(h-w)<=0?p=r:(a=r,t=w)}q<m?(s=Math.ceil(b("radToDeg")(a)),v=Math.ceil(b("radToDeg")(c))):(s=d,v=e);return{yaw:s,pitch:v}},convert2dTo3dScaled:function(a,b,c,d,e,f,g){var h=f/2,i=g/2;return o.convert2dTo3dNormalized((a-h)*(2/f),(b-i)*(2/g),c,d,e,f,g)},_getRelativePositionWithoutProjection:function(a,b,c,d){__p&&__p();var e=(b-d)/2;b=(b+d)/2;d=Math.cos((a-c)/2);a=Math.sin((a-c)/2);c=Math.cos(e)*d;e=Math.sin(e)*d;d=Math.cos(b)*a;b=Math.sin(b)*a;a=2*e*b+2*c*d;b=2*d*b-2*c*e;c=1-2*e*e-2*d*d;return{x:a/c,y:b/c}},distanceBetweenSphericalCoordinatesDeg:function(a,c,d,e){return b("radToDeg")(o.distanceBetweenSphericalCoordinatesRad.apply(o,Array.from(arguments).map(b("degToRad"))))},distanceBetweenSphericalCoordinatesRad:function(a,b,c,d){return j(k(b)*k(d)+l(b)*l(d)*l(a-c))}};e.exports=o}),null);
__d("SphericalMediaTaggingUtils",["SphericalPhotoProjectionUtils","SphericalProjectionUtils","degToRad","gl-matrix","radToDeg"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("gl-matrix").vec3,h={getSpatialTagArea:function(a,c,d){var e=d.h/c.fov;e={w:Math.abs(a.width_degree)*e,h:Math.abs(a.height_degree)*e};a=b("SphericalProjectionUtils").convert3dTo2dScaledUnique(a.center.yaw,a.center.pitch,c.yaw,c.pitch,c.fov,d.w,d.h);return{topLeft:{x:a.x-e.w/2,y:a.y-e.h/2},bottomRight:{x:a.x+e.w/2,y:a.y+e.h/2}}},getSpatialTagAreaInNewPhotoRenderer:function(a,c,d,e){var f=d.h/c.fov;f={w:Math.abs(a.width_degree)*f,h:Math.abs(a.height_degree)*f};a=b("SphericalPhotoProjectionUtils").convert3dTo2d(a.center.yaw,a.center.pitch,c,d.w,d.h,e);return{topLeft:{x:a.x-f.w/2,y:a.y-f.h/2},bottomRight:{x:a.x+f.w/2,y:a.y+f.h/2}}},isPointInTagArea:function(a,b,c,d){b=h.getSpatialTagArea(b,c,d);return!(b.topLeft.x>a.x||b.bottomRight.x<a.x||b.topLeft.y>a.y||b.bottomRight.y<a.y)},isPointInTagAreaInNewPhotoRenderer:function(a,b,c,d,e){b=h.getSpatialTagAreaInNewPhotoRenderer(b,c,d,e);return!(b.topLeft.x>a.x||b.bottomRight.x<a.x||b.topLeft.y>a.y||b.bottomRight.y<a.y)},pointsToRectSize:function(a){var b=a.topLeft;a=a.bottomRight;return{w:Math.abs(a.x-b.x),h:Math.abs(a.y-b.y)}},rectSizeToPoints:function(a,b){return{topLeft:a,bottomRight:{x:a.x+Math.abs(b.w),y:a.y+Math.abs(b.h)}}},rectSizeToDegreeSize:function(a,b,c){var d=Number(c.FullPanoHeightPixels);c=Number(c.FullPanoWidthPixels);return{widthDegree:a/c*360,heightDegree:b/d*180}},degreeSizeToRectSize:function(a,b,c){var d=Number(c.FullPanoHeightPixels);c=Number(c.FullPanoWidthPixels);return{w:a/360*c,h:b/180*d}},yawPitchToPhotoXY:function(a,c,d){__p&&__p();var e=Number(d.PosePitchDegrees),f=Number(d.PoseRollDegrees),i=Number(d.CroppedAreaImageHeightPixels),j=Number(d.CroppedAreaImageWidthPixels),k=Number(d.CroppedAreaLeftPixels),l=Number(d.CroppedAreaTopPixels),m=Number(d.FullPanoHeightPixels);d=Number(d.FullPanoWidthPixels);a=h.yawPitchToVec3(a,c);c=[a.x,a.y,a.z];e!==0&&g.rotateX(c,c,[0,0,0],b("degToRad")(-e));f!==0&&g.rotateZ(c,c,[0,0,0],b("degToRad")(f));a=h.vec3ToPhotoXY(c[0],c[1],c[2]);e=a.x*d-k;f=a.y*m-l;c=e/j;d=f/i;return{x:c,y:d}},photoXYToYawPitch:function(a,c){__p&&__p();var d=Number(c.PosePitchDegrees),e=Number(c.PoseRollDegrees),f=Number(c.CroppedAreaImageHeightPixels),i=Number(c.CroppedAreaImageWidthPixels),j=Number(c.CroppedAreaLeftPixels),k=Number(c.CroppedAreaTopPixels),l=Number(c.FullPanoHeightPixels);c=Number(c.FullPanoWidthPixels);i=a.x*i;a=a.y*f;f=(i+j)/c;i=(a+k)/l;j=h.photoXYToVec3(f,i);c=[j.x,j.y,j.z];e!==0&&g.rotateZ(c,c,[0,0,0],b("degToRad")(-e));d!==0&&g.rotateX(c,c,[0,0,0],b("degToRad")(d));return h.vec3ToYawPitch.apply(h,c)},yawPitchToVec3:function(a,c){var d=b("degToRad")(a);c=b("degToRad")(90-c);a=Math.abs(a)>90?1:-1;d=Math.tan(d)*-a;if(!isFinite(d))return{x:1,y:0,z:0};c=Math.sqrt(d*d+a*a)/Math.tan(c);return!isFinite(c)?{x:0,y:1,z:0}:{x:d,y:c,z:a}},vec3ToYawPitch:function(a,c,d){c=Math.atan2(Math.sqrt(a*a+d*d),c);a=Math.atan2(a,-d);return{yaw:b("radToDeg")(a),pitch:90-b("radToDeg")(c)}},vec3ToPhotoXY:function(a,b,c){var d=Math.abs(Math.atan2(b,Math.sqrt(a*a+c*c)));b>0&&d<0&&(d*=-1);b<0&&d>0&&(d*=-1);d=(-d+Math.PI/2)/Math.PI;b=-1*Math.atan2(a,c);b<0&&(b+=2*Math.PI);b/=2*Math.PI;return{x:b,y:d}},photoXYToVec3:function(a,b){var c=(b-.5)*Math.PI,d=Math.sin(c);c=Math.cos(c);var e=(a-.75)*2*Math.PI,f=Math.sin(e);e=Math.cos(e);a=e*c;b=-d;e=f*c;return{x:a,y:b,z:e}},normalizeComposerXYToPhotoXY:function(a){return a/100},normalizePhotoXYToComposerXY:function(a){return a*100},coordinatesAreClose:function(a,b,c){c===void 0&&(c=.001);var d=Math.abs(a.x-b.x);a=Math.abs(a.y-b.y);return!(d>c||a>c)},compareTags:function(a,b){return!(a.center.pitch!==b.center.pitch||a.center.vec3[0]!==b.center.vec3[0]||a.center.vec3[1]!==b.center.vec3[1]||a.center.vec3[2]!==b.center.vec3[2]||a.center.yaw!==b.center.yaw||a.centerXY.x!==b.centerXY.x||a.centerXY.y!==b.centerXY.y||a.height_degree!==b.height_degree||a.width_degree!==b.width_degree)},getSpatialTagFromFBID:function(a,b){for(var c=0;c<b.length;c++)if(b[c].fbid==a)return b[c];return null}};e.exports=h}),null);
__d("SphericalPhotoController.redux",["DOM","ReactRedux","SphericalMediaBaseActions","SphericalMediaConstants","SphericalMediaController.react","SphericalMediaTaggingUtils","SphericalMediaViewActions","SphericalPhotoPartialLimits","SphericalPhotoProjectionUtils","SphericalPhotoTypedConfig","SphericalProjectionUtils","UserAgent","goURI","normalizeDeltaYaw"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=b("ReactRedux").connect;var h=b("SphericalMediaBaseActions").dragStart,i=b("SphericalMediaBaseActions").gyroStart,j=b("SphericalMediaBaseActions").mouseEnter,k=b("SphericalMediaBaseActions").redirectFromClickedTag,l=b("SphericalMediaBaseActions").significantMove,m=b("SphericalMediaBaseActions").taggingStart,n=b("SphericalMediaBaseActions").taggingStop,o=b("SphericalMediaBaseActions").updateBase,p=b("SphericalMediaBaseActions").updateCtrElem,q=b("SphericalMediaBaseActions").updateInitialViewport,r=b("SphericalMediaBaseActions").updateTagClicked,s=b("SphericalMediaBaseActions").updateTagUnderMouse,t=b("SphericalMediaBaseActions").viewportClicked,u=b("SphericalMediaBaseActions").zoomStart,v=b("SphericalMediaConstants").UNTAGGED_FACEBOX,w=b("SphericalMediaViewActions").stopAnimating,x=b("SphericalMediaViewActions").updateFOV,y=b("SphericalMediaViewActions").updateViewportAndFOV,z=b("SphericalPhotoPartialLimits").makePartialLimits,A=b("SphericalProjectionUtils").convert3dTo2dScaledUnique;d=babelHelpers.inherits(a,b("SphericalMediaController.react"));g=d&&d.prototype;function a(){__p&&__p();var a,b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=(a=g.constructor).call.apply(a,[this].concat(d)),this.$SphericalPhotoController5=function(){this.onViewChange()}.bind(this),this.__onUpdateViewportBegin=function(){this.props.viewStore.dispatch(w())}.bind(this),this.__onUpdateViewportMoveStart=function(a){var b=this.props.dispatch;a?b(i()):b(h())}.bind(this),this.__onDOMClick=function(a){if(this.props.enableTagging){this.props.taggingMode?this.$SphericalPhotoController8(a):this.$SphericalPhotoController10(a);a=this.$SphericalPhotoController7(a);this.props.dispatch(r(a))}this.props.dispatch(t())}.bind(this),this.__onViewportChange=function(a,b,c){if(this.props.enableTagging){var d=this.props,e=d.dispatch,f=d.isTagging;d=d.tagger;f&&d&&(d.hideTagger(),e(n()));e(r(null))}this.props.viewStore.dispatch(y(a,b,c))}.bind(this),this.__onInitialViewportChange=function(a,b){this.props.dispatch(q(a,b))}.bind(this),this.__onZoomStart=function(){this.props.dispatch(u())}.bind(this),this.__onMouseEnter=function(){this.props.dispatch(j())}.bind(this),this.__onMouseMove=function(a){if(this.props.enableTagging){var b=this.$SphericalPhotoController7(a);b?b.type!==v?this.__changeCursorStyle("pointer"):this.__changeCursorStyle("crosshair"):this.__changeCursorStyle(this.$SphericalPhotoController6());this.props.dispatch(s(this.$SphericalPhotoController7(a)))}}.bind(this),b}a.prototype.UNSAFE_componentWillReceiveProps=function(a){g.UNSAFE_componentWillReceiveProps.call(this,a),a.isTagging?this.__sphericalViewportControl&&this.__sphericalViewportControl.disableKeyboard():this.__sphericalViewportControl&&this.__sphericalViewportControl.enableKeyboard(),a.enableTagging&&this.props.taggingMode!==a.taggingMode&&this.$SphericalPhotoController3(a),a.partialLimits.equals(this.props.partialLimits)||this.$SphericalPhotoController4(a)};a.prototype.shouldComponentUpdate=function(a){a=g.shouldComponentUpdate.call(this,a)||this.props.tagger!==a.tagger&&this.props.enableTagging;return a};a.prototype.componentDidMount=function(){g.componentDidMount.call(this),this.props.viewStore.subscribe(this.$SphericalPhotoController5),this.props.dispatch(p(this.__viewport)),this.props.enableTagging&&this.$SphericalPhotoController3(this.props)};a.prototype.componentDidUpdate=function(){g.componentDidUpdate.call(this),this.props.dispatch(p(this.__viewport)),this.props.enableTagging&&this.$SphericalPhotoController3(this.props)};a.prototype.componentWillUnmount=function(){g.componentWillUnmount.call(this),this.props.dispatch(p(null))};a.prototype.$SphericalPhotoController3=function(a){var c=a.tagger,d=this.__sphericalViewportControl;if(c&&d){this.$SphericalPhotoController1&&(d.removeLayer(this.$SphericalPhotoController1),this.$SphericalPhotoController1=null);this.$SphericalPhotoController2&&(d.removeLayer(this.$SphericalPhotoController2),this.$SphericalPhotoController2=null);try{var e=b("DOM").find(c.tagger,"div.faceBox");this.$SphericalPhotoController1=d.addNewLayer(e);a.taggingMode&&(this.$SphericalPhotoController2=d.addNewLayer(c.viewer.stageActions))}catch(a){}}};a.prototype.$SphericalPhotoController4=function(a){this.__sphericalViewportControl&&(this.__sphericalViewportControl.reconfigure(this.__getSphericalConfig(a)),a.viewStore.dispatch(y(a.initialYaw,a.initialPitch,a.initialFov)))};a.prototype.$SphericalPhotoController6=function(){var a="grab";b("UserAgent").isEngine("WebKit")?a="-webkit-"+a:b("UserAgent").isEngine("Gecko")&&(a="-moz-"+a);return a};a.prototype.$SphericalPhotoController7=function(a){__p&&__p();var c=this.__getViewportMousePosition(a);if(!c)return null;a=this.props;var d=a.partialLimits,e=a.showNewPhotoRenderer;a=a.tags;var f=this.props.viewStore.getState(),g=f.view;f=null;a&&a.forEach(function(a){(e&&b("SphericalMediaTaggingUtils").isPointInTagAreaInNewPhotoRenderer(c,a,g,{w:this.props.width,h:this.props.height},z({partialLeftDegrees:d.partialLeftDegrees,partialRightDegrees:d.partialRightDegrees,partialTopDegrees:d.partialTopDegrees,partialBottomDegrees:d.partialBottomDegrees}))||b("SphericalMediaTaggingUtils").isPointInTagArea(c,a,g,{w:this.props.width,h:this.props.height}))&&(f=a)}.bind(this));return f};a.prototype.$SphericalPhotoController8=function(a){__p&&__p();if(!this.props.tagger)return;var c=this.$SphericalPhotoController7(a),d=this.__getViewData(),e=this.props,f=e.height,g=e.partialLimits,h=e.photoSphereMetadata,i=e.showNewPhotoRenderer;e=e.width;var j,l;if(c){if(c.type!==v){this.props.dispatch(k());c.url&&b("goURI")(c.url,!0);return}if(c.type===v){var n=c.center,o=n.yaw;n=n.pitch;i?(j=b("SphericalPhotoProjectionUtils").convert3dTo2d(o,n,d,e,f,g),l=b("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer(c,d,{w:e,h:f},g)):(j=A(o,n,d.yaw,d.pitch,d.fov,e,f),l=b("SphericalMediaTaggingUtils").getSpatialTagArea(c,d,{w:e,h:f}));o=c.centerXY;n=b("SphericalMediaTaggingUtils").pointsToRectSize(l);l=this.$SphericalPhotoController9(c)}else return}else{j=this.__getViewportMousePosition(a);n={w:100};if(!j)return;if(i){i=b("SphericalPhotoProjectionUtils").convert2dTo3d(j.x,j.y,d,e,f,g);if(!i)return}else i=b("SphericalProjectionUtils").convert2dTo3dScaled(j.x,j.y,d.yaw,d.pitch,d.fov,e,f);o=b("SphericalMediaTaggingUtils").yawPitchToPhotoXY(b("normalizeDeltaYaw")(i.yaw),i.pitch,h);l=null}if(o.y<0||o.y>1)return;this.props.tagger.addSpatialTag({screenPos:j,photoXY:o,suggestion:l,size:n.w,fromTag:!!c,inTaggingMode:this.props.taggingMode},a);this.props.dispatch(m())};a.prototype.$SphericalPhotoController10=function(a){__p&&__p();var c=this.$SphericalPhotoController7(a);if(c)if(c.type!==v){this.props.dispatch(k());c.url&&b("goURI")(c.url,!0);return}else{if(!this.props.tagger)return;var d=this.props,e=d.height,f=d.partialLimits,g=d.showNewPhotoRenderer;d=d.width;var h=c.center,i=h.yaw;h=h.pitch;var j=this.__getViewData(),l;g?l=b("SphericalPhotoProjectionUtils").convert3dTo2d(i,h,j,d,e,f):l=A(i,h,j.yaw,j.pitch,j.fov,d,e);i=c.centerXY;g?h=b("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer(c,j,{w:d,h:e},f):h=b("SphericalMediaTaggingUtils").getSpatialTagArea(c,j,{w:d,h:e});g=b("SphericalMediaTaggingUtils").pointsToRectSize(h);f=this.$SphericalPhotoController9(c);this.props.tagger.addSpatialTag({screenPos:l,photoXY:i,suggestion:f,size:g.w,fromTag:!0,inTaggingMode:this.props.taggingMode},a);this.props.dispatch(m())}else this.props.isTagging&&(this.props.tagger.hideTagger(),this.props.dispatch(n()))};a.prototype.$SphericalPhotoController9=function(a){__p&&__p();if(!this.props.tagger||this.props.tagger.faceboxes.length<1)return null;var c=null,d=this.props.tagger.faceboxes;d.forEach(function(d){var e=d.rect,f=e.l,g=e.r,h=e.t;e=e.b;g={x:f+(g-f)/2,y:h+(e-h)/2};try{f=JSON.parse(d.node.getAttribute("data-recognizeduids"));b("SphericalMediaTaggingUtils").coordinatesAreClose(g,a.centerXY)&&f.length>0&&(c=d)}catch(a){c=null}});return c};a.prototype.__onUpdateViewportEnd=function(){this.props.dispatch(o({isPanning:!1}))};a.prototype.__onSignificantMove=function(a){this.props.dispatch(l(a))};a.prototype.__updateFOV=function(a){this.props.viewStore.dispatch(x(a))};a.prototype.__getViewData=function(){var a=this.props.viewStore.getState();a=a.view;return{fov:a.fov,pitch:a.pitch,yaw:a.yaw}};a.__subClassMethods={__getViewData:!0,__onUpdateViewportBegin:!0,__onUpdateViewportMoveStart:!0,__onDOMClick:!0,__onUpdateViewportEnd:!0,__onViewportChange:!0,__onInitialViewportChange:!0,__onZoomStart:!0,__onMouseEnter:!0,__onMouseMove:!0,__onSignificantMove:!0,__updateFOV:!0};f=function(a){var c=a.base;return{aspectRatio:c.aspectRatio,caption:c.caption,enableGyro:c.enableGyro,enableRubberBanding:c.enableRubberBanding,enableTagging:c.enableTagging&&!b("SphericalPhotoTypedConfig").enable_stereograph_renderer,enableZoom:c.enableZoom,height:c.height,initialFov:c.initialFov,initialPitch:c.initialPitch,initialYaw:c.initialYaw,isActive:c.isRendererActive&&c.isRendererSetup||c.showFallbackUI,isTagging:c.isTagging,keyboardVelocityFactor:c.keyboardVelocityFactor,maxTileLevel:c.tiledSphericalConfig.maxTileLevel,panningVelocityFactor:c.panningVelocityFactor,partialLimits:c.partialLimits,photoSphereMetadata:a.base.photoSphereMetadata,tagger:c.tagger,taggingMode:c.taggingMode,tags:c.tags,showNewPhotoRenderer:c.tiledSphericalConfig.useTiledRenderer&&b("SphericalPhotoTypedConfig").show_new_renderer,viewStore:c.viewStore,width:c.width}};e.exports=c(f)(a)}),null);
__d("SphericalPhotoFallbackMiddleware",["SphericalMediaActions","SphericalMediaBaseActions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalMediaBaseActions").disableTagging,h=b("SphericalMediaBaseActions").useFallbackUI;a=function(a){var c=a.dispatch;a.getState;return function(a){return function(d){d.type===b("SphericalMediaActions").WEBGL_INIT_FAILED&&(c(g()),c(h()));return a(d)}}};e.exports=a}),null);
__d("CubemapImageTile",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){this.$1=a,this.$2=b}a.prototype.getInfo=function(){return this.$1};a.prototype.getImg=function(){return this.$2};e.exports=a}),null);
__d("CubemapImageTileInfo",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a,b,c,d){this.level=a,this.face=b,this.col=c,this.row=d}g.prototype.getKey=function(){return""+this.level+"_"+this.face+"_"+this.col+"_"+this.row};g.prototype.getInfoForOffsetLevel=function(a){var b=this.level-a;if(b<0)throw new Error("Invalid level offset for getKeyForOffsetLevel: "+a+", max offset: "+this.level);var c=Math.floor(this.col/Math.pow(2,a));a=Math.floor(this.row/Math.pow(2,a));return new g(b,this.face,c,a)};e.exports=g}),null);
__d("CubemapImageTileProvider",["Bootloader","CubemapImageTile","CubemapImageTileInfo","QE2Logger","SphericalMediaConstants","SphericalPhotoConstants","SphericalPhotoTypedConfig","URI","performanceNow"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalMediaConstants").TILED_CUBE_FACES,h=b("SphericalMediaConstants").TILED_CUBE_TILE_CONTENT_SIZE,i=b("SphericalMediaConstants").TILED_CUBE_TILE_PADDING_PIXELS;b("SphericalPhotoConstants").QE_WWW_UNIVERSE;function a(a,c,d){this.$15=function(a,c,d){var e=new Image(),f=new(b("CubemapImageTile"))(a,e);e.crossOrigin="anonymous";e.onload=function(){return this.$16(f,d)}.bind(this);e.src=c;e.onerror=function(){return this.$17(e,a)}.bind(this)}.bind(this),this.$1=a,this.$10=0,this.$11={},this.$2=!1,this.$3=[],this.$4=[],this.$5=new Map(),this.$6=new Map(),this.$7=!1,this.$8=[],this.$9=new Map(),this.$12=c,this.$13(),d&&d.length?this.$14(d):this.$7=!0}a.prototype.getTileContentSize=function(){return h};a.prototype.getTilePaddingPixels=function(){return i};a.prototype.getTileTotalSize=function(){return 2*i+h};a.prototype.getMaxTileLevel=function(){return this.$12};a.prototype.getTotalPixelsLoaded=function(){return this.$10*Math.pow(this.getTileTotalSize(),2)};a.prototype.getBaseLevelImageTiles=function(){return this.$5};a.prototype.getViewportImageTiles=function(){return this.$9};a.prototype.addBaseLevelReadyCallback=function(a){!this.$2?this.$3.push(a):a()};a.prototype.isBaseLevelReady=function(){return this.$2};a.prototype.isViewportReady=function(){return this.$7};a.prototype.loadTileImage=function(a,b,c){var d=a.getKey();d in this.$11?b(this.$11[d],c):this.$1.getUriForTile(a,function(a,c){this.$15(a,c,b)}.bind(this))};a.prototype.$13=function(){this.$4=[new(b("CubemapImageTileInfo"))(0,g.PLUS_X,0,0),new(b("CubemapImageTileInfo"))(0,g.MINUS_X,0,0),new(b("CubemapImageTileInfo"))(0,g.PLUS_Y,0,0),new(b("CubemapImageTileInfo"))(0,g.MINUS_Y,0,0),new(b("CubemapImageTileInfo"))(0,g.PLUS_Z,0,0),new(b("CubemapImageTileInfo"))(0,g.MINUS_Z,0,0)],this.$4.forEach(function(a){return this.$1.getUriForTile(a,this.$15)}.bind(this))};a.prototype.$14=function(a){a.forEach(function(a){var c=new(b("CubemapImageTileInfo"))(a.level,a.face,a.col,a.row);this.$8.push(c);this.$15(c,a.uri)}.bind(this))};a.prototype.$17=function(a,c){b("Bootloader").loadModules(["SphericalPhotoViewerTypedLogger","SphericalPhotoViewerLogEvents"],function(a,b){a=new a();a.setName(b.CDN_IMAGE_FAILURE).setErrorMessage(c.getKey()).log()},"CubemapImageTileProvider");this.$6.has(c.getKey())||this.$6.set(c.getKey(),0);var d=this.$6.get(c.getKey());typeof d==="number"&&!isNaN(d)&&d<10&&setTimeout(function(){var e=new(b("URI"))(a.src);a.src=e.addQueryData("time",Date.now().toString()).toString();this.$6.set(c.getKey(),d+1)}.bind(this),500)};a.prototype.$16=function(a,c){__p&&__p();var d=a.getInfo().getKey();this.$11[d]=a;this.$10++;if(!this.$2){d=this.$4.every(function(a){return a.getKey()in this.$11}.bind(this));var e=this.$8.length?this.$8.every(function(a){return a.getKey()in this.$11}.bind(this)):!0;a.getInfo().level===0?this.$5.set(a.getInfo().getKey(),a):this.$9.set(a.getInfo().getKey(),a);d&&e&&this.$18()}else c&&c(a,b("performanceNow")())};a.prototype.$18=function(){this.$2=!0,this.$7=!0,this.$3.forEach(function(a){return a()})};e.exports=a}),null);
__d("BaseCubemapTileUriProvider",["invariant","CubemapImageTileInfo"],(function(a,b,c,d,e,f,g){"use strict";a.prototype.getUriForTile=function(a,b){g(0,5547)};function a(){}e.exports=a}),null);
__d("XSphericalPhotoTileURIsAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/spherical_media/photo/tile/",{})}),null);
__d("EntPhotoCubemapTileUriProvider",["Promise","BaseCubemapTileUriProvider","CubemapImageTileInfo","XAsyncRequest","XSphericalPhotoTileURIsAsyncController","flattenPHPQueryData","throttle"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=200;c=babelHelpers.inherits(a,b("BaseCubemapTileUriProvider"));g=c&&c.prototype;function a(a,c){g.constructor.call(this),this.$EntPhotoCubemapTileUriProvider9=b("throttle")(function(){this.$EntPhotoCubemapTileUriProvider10(this.$EntPhotoCubemapTileUriProvider3),this.$EntPhotoCubemapTileUriProvider3=new Map()}.bind(this),h),this.$EntPhotoCubemapTileUriProvider1=a,this.$EntPhotoCubemapTileUriProvider2=new Map(),this.$EntPhotoCubemapTileUriProvider3=new Map(),this.$EntPhotoCubemapTileUriProvider4=new Map(),this.$EntPhotoCubemapTileUriProvider5=new Map(),this.$EntPhotoCubemapTileUriProvider7(c),this.$EntPhotoCubemapTileUriProvider6=0}a.prototype.getUriForTile=function(a,b){var c=a.getKey(),d=this.$EntPhotoCubemapTileUriProvider2.get(c);if(!d){if(this.$EntPhotoCubemapTileUriProvider5.has(c))return;this.$EntPhotoCubemapTileUriProvider8({tileInfo:a,onURIfetched:b})}else b(a,d)};a.prototype.$EntPhotoCubemapTileUriProvider8=function(a){var b=a.tileInfo.getKey(),c=this.$EntPhotoCubemapTileUriProvider3.get(b),d=this.$EntPhotoCubemapTileUriProvider4.get(b);!c&&!d&&(this.$EntPhotoCubemapTileUriProvider3.set(b,a),this.$EntPhotoCubemapTileUriProvider9())};a.prototype.$EntPhotoCubemapTileUriProvider10=function(a){__p&&__p();if(a.size===0)return new(b("Promise"))(function(){});var c=[];a.forEach(function(a){a=a.tileInfo;this.$EntPhotoCubemapTileUriProvider4.set(a.getKey(),a);c.push({level:a.level,face:a.face,col:a.col,row:a.row})}.bind(this));var d={photo_id:this.$EntPhotoCubemapTileUriProvider1,tile_info_list:c};return this.$EntPhotoCubemapTileUriProvider11(b("XSphericalPhotoTileURIsAsyncController").getURIBuilder().getURI(),d).then(function(b){this.$EntPhotoCubemapTileUriProvider7(b.payload),a.forEach(function(a){var b=a.tileInfo;a=a.onURIfetched;var c=b.getKey(),d=this.$EntPhotoCubemapTileUriProvider2.get(c);d?a(b,d):this.$EntPhotoCubemapTileUriProvider5.set(c,!0);this.$EntPhotoCubemapTileUriProvider4["delete"](c)}.bind(this))}.bind(this),function(a){}.bind(this))};a.prototype.$EntPhotoCubemapTileUriProvider11=function(a,c){return new(b("Promise"))(function(d,e){return new(b("XAsyncRequest"))(a).setMethod("POST").setData(b("flattenPHPQueryData")(c)).setHandler(d).setErrorHandler(e).send()})};a.prototype.$EntPhotoCubemapTileUriProvider7=function(a){a.forEach(function(a){var c=new(b("CubemapImageTileInfo"))(a.level,a.face,a.col,a.row);this.$EntPhotoCubemapTileUriProvider2.set(c.getKey(),a.uri)}.bind(this))};e.exports=a}),null);
__d("StaticCubemapTileUriProvider",["BaseCubemapTileUriProvider","CubemapImageTileInfo"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=babelHelpers.inherits(a,b("BaseCubemapTileUriProvider"));g=c&&c.prototype;function a(a){g.constructor.call(this),this.$StaticCubemapTileUriProvider1=new Map(),a.forEach(function(a){var c=new(b("CubemapImageTileInfo"))(a.level,a.face,a.col,a.row);this.$StaticCubemapTileUriProvider1.set(c.getKey(),a.uri)}.bind(this))}a.prototype.getUriForTile=function(a,b){var c=a.getKey();c=this.$StaticCubemapTileUriProvider1.get(c);c&&b(a,c)};e.exports=a}),null);
__d("BaseRotatableWebGLRenderer",["EventEmitter","EventListener","getErrorNameFromWebGLErrorCode","gl-matrix","performanceNow","radToDeg","requestAnimationFrame"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("gl-matrix").glMatrix,i=b("gl-matrix").mat4,j=Math.max(window.devicePixelRatio||1,1),k=179;d=babelHelpers.inherits(c,b("EventEmitter"));g=d&&d.prototype;function c(a,b){__p&&__p();b===void 0&&(b={});g.constructor.call(this);this.__handleContextLost=function(a){a.preventDefault(),this.emit("renderingContextLost"),this.__contextLost=!0}.bind(this);this.__handleContextRestore=function(a){this.__setup(),this.emit("renderingContextRestore")}.bind(this);if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var c in this.constructor.__subClassMethods)if(typeof this[c]!=="function")throw new Error('Must implement "'+c+'"');this.__glContextAttributes=b;this.__firstRenderTime=-1;this.__previousRenderFinishTime=-1;this.__sumOfRenderTimes=0;this.$BaseRotatableWebGLRenderer1=-1;this.__framesRenderedCount=0;this.__sumTextureScreenRatioValues=0;this.__textureScreenRatioMillisCounted=0;this.__canvas=a;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__shaders=[];this.__contextLost=!1;this.__horizontalFieldOfView=0;this.__verticalFieldOfView=0;this.__perspectiveMatrix=i.create();this.__rotationMatrix=i.create();this.__shouldEnableBlend=!1;this.__useVfovAsIs=!1;this.__canvas.addEventListener("webglcontextlost",this.__handleContextLost);this.__canvas.addEventListener("webglcontextrestored",this.__handleContextRestore)}c.prototype.destroy=function(){this.__canvas.removeEventListener("webglcontextlost",this.__handleContextLost),this.__canvas.removeEventListener("webglcontextrestored",this.__handleContextRestore),this.__shaders.forEach(function(a){try{this.__gl.detachShader(this.__shaderProgram,a)}catch(a){}}.bind(this)),this.__shaders=[],this.__clearCache(),this.__destroyed=!0};c.prototype.updateFieldOfView=function(a){var b=Math.min(a,k/this.__aspectRatio);this.__useVfovAsIs&&(b=a);a=Math.min(k,b);this.__verticalFieldOfView=a;this.__updateHorizontalFieldOfView();this.__updatePerspective()};c.prototype.updateViewportDimensions=function(a,b){this.__canvas.width=a*j,this.__canvas.height=b*j,this.__aspectRatio=this.__canvas.width/this.__canvas.height||1,this.__updateHorizontalFieldOfView(),this.__updatePerspective()};c.prototype.hasRenderingContext=function(){return!this.__contextLost};c.prototype.getScreenshotDataURL=function(a,b,c){if(!this.__gl||this.__contextLost)return"";this.render(a);return this.__canvas.toDataURL(b,c)};c.prototype.getAverageFrameRenderTimeMillis=function(){return this.__framesRenderedCount===0?0:this.__sumOfRenderTimes/this.__framesRenderedCount};c.prototype.getMaxGPUMemoryUsedBytes=function(){return this.__getMaxGPUMemoryUsedBytes()};c.prototype.getAverageTextureToScreenPixelRatio=function(){return this.__textureScreenRatioMillisCounted===0?0:this.__sumTextureScreenRatioValues/this.__textureScreenRatioMillisCounted};c.prototype.getTimeSinceFirstRenderMillis=function(){return b("performanceNow")()-this.__firstRenderTime};c.prototype.renderErrorCheck=function(){this.__createTexture()};c.prototype.render=function(a){__p&&__p();if(this.__contextLost||this.__destroyed)return;this.__view=a;if(!this.__isValidView(a)){this.emit("renderingError",new Error("invalid view"),a);return}var c=b("performanceNow")();this.__firstRenderTime===-1&&(this.__firstRenderTime=c);a.fov!==this.__verticalFieldOfView&&this.updateFieldOfView(a.fov);i.identity(this.__rotationMatrix);i.rotateX(this.__rotationMatrix,this.__rotationMatrix,-h.toRadian(a.pitch));i.rotateY(this.__rotationMatrix,this.__rotationMatrix,h.toRadian(a.yaw));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,!1,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__perspectiveMatrix);a=this.__getPrevFrameTextureScreenRatio();this.__renderInternal();var d=b("performanceNow")();this.__sumOfRenderTimes+=d-c;this.__framesRenderedCount+=1;if(this.__previousRenderFinishTime>0){c=2e3;c=Math.min(d-this.__previousRenderFinishTime,c);this.__sumTextureScreenRatioValues+=c*a;this.__textureScreenRatioMillisCounted+=c}this.__previousRenderFinishTime=d};c.prototype.renderWithRotationMatrixForMSite=function(a){i.rotateX(a,a,h.toRadian(90)),this.renderWithRotationMatrix(a)};c.prototype.renderWithRotationMatrix=function(a){if(this.__contextLost)return;this.__rotationMatrix=a;this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,!1,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__perspectiveMatrix);this.__renderInternal()};c.prototype.__isValidView=function(a){return!Number.isNaN(a.fov+a.pitch+a.yaw)};c.prototype.__copyTextureToGLBuffer=function(a,b,c){c===void 0&&(c=!1);b=this.__getNewGLTexObj(b);this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,c);this.__gl.bindTexture(this.__gl.TEXTURE_2D,b);this.__gl.texImage2D(this.__gl.TEXTURE_2D,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,a.image);this.$BaseRotatableWebGLRenderer2();return b};c.prototype.__setup=function(){(!this.__gl||!this.__contextLost)&&(this.__gl=this.__getGL(),this.__contextLost=!1);this.__gl.clearColor(0,0,0,1);this.__shouldEnableBlend&&(this.__gl.enable(this.__gl.BLEND),this.__gl.blendFunc(this.__gl.SRC_ALPHA,this.__gl.ONE_MINUS_SRC_ALPHA));this.updateViewportDimensions(this.__canvas.clientWidth,this.__canvas.clientHeight);var a=this.__initShaders();if(!a.success){var c=b("getErrorNameFromWebGLErrorCode")(this.__gl.getError());throw new Error("\n        Failed to intialize shaders: "+c+"\n        Error Message: "+a.error+"\n      ")}};c.prototype.__getGL=function(){__p&&__p();if(this.__gl&&!this.__contextLost)return this.__gl;if(!a.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=null,e=null,f=b("EventListener").listen(this.__canvas,"webglcontextcreationerror",function(a){return e=a.statusMessage});for(var g=0;g<c.length;g++){try{d=this.__canvas.getContext(c[g],this.__glContextAttributes)}catch(a){}if(d)break}f.remove();if(!d){e=e||"Unknown error.";throw new Error("Failed to acquire 3D rendering context: "+e)}return d};c.prototype.__updatePerspective=function(){i.perspective(this.__perspectiveMatrix,h.toRadian(this.__verticalFieldOfView),this.__aspectRatio,.1,100),this.__gl.viewport(0,0,this.__gl.drawingBufferWidth,this.__gl.drawingBufferHeight)};c.prototype.__initShaders=function(){__p&&__p();this.__shaderProgram=this.__gl.createProgram();try{this.__attachShaders(this.__shaderProgram)}catch(a){return{success:!1,error:"Shader: "+a.message}}this.__gl.linkProgram(this.__shaderProgram);var a=this.__gl.getProgramParameter(this.__shaderProgram,this.__gl.LINK_STATUS);if(!a)return{success:!1,error:"No link. Could not initialize shaders"};this.__gl.useProgram(this.__shaderProgram);this.__setShaderMatrixPointers();this.__shaderProgramReady();return{success:!0,error:""}};c.prototype.__setShaderMatrixPointers=function(){this.__shaderPMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderPerspectiveMatrixUniformName()),this.__shaderRotMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderRotationMatrixUniformName())};c.prototype.__getShaderConfigs=function(){var a=new Map();a.set(this.__gl.VERTEX_SHADER,this.__getVertexShaderScript());a.set(this.__gl.FRAGMENT_SHADER,this.__getFragmentShaderScript());return a};c.prototype.__attachShaders=function(a){var b=this.__getShaderConfigs();b.forEach(function(b,c){c=this.__gl.createShader(c);this.__gl.shaderSource(c,b);this.__gl.compileShader(c);if(!this.__gl.getShaderParameter(c,this.__gl.COMPILE_STATUS))throw new Error(this.__gl.getShaderInfoLog(c));this.__gl.attachShader(a,c);this.__shaders.push(c)}.bind(this))};c.prototype.__getNewGLTexObj=function(a){var b=this.__gl.createTexture();this.__gl.bindTexture(a,b);this.__gl.texParameteri(a,this.__gl.TEXTURE_MAG_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(a,this.__gl.TEXTURE_MIN_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(a,this.__gl.TEXTURE_WRAP_S,this.__gl.CLAMP_TO_EDGE);this.__gl.texParameteri(a,this.__gl.TEXTURE_WRAP_T,this.__gl.CLAMP_TO_EDGE);this.__gl.bindTexture(a,null);return b};c.prototype.__updateHorizontalFieldOfView=function(){var a=h.toRadian(this.__verticalFieldOfView);a=2*Math.atan(Math.tan(a/2)*this.__aspectRatio);this.__horizontalFieldOfView=b("radToDeg")(a)};c.prototype.__emitRenderingError=function(a){this.emit("renderingError",new Error("WebGL Error Code: "+a))};c.prototype.$BaseRotatableWebGLRenderer2=function(){var a=b("performanceNow")()-this.$BaseRotatableWebGLRenderer1;a>1e3&&b("requestAnimationFrame")(function(){this.$BaseRotatableWebGLRenderer1=b("performanceNow")();var a=this.__gl.getError();a!==0&&this.__emitRenderingError(a)}.bind(this))};e.exports=c}),null);
__d("StereographicProjectionUtils",["gl-matrix"],(function(a,b,c,d,e,f){__p&&__p();var g=b("gl-matrix").vec2,h=b("gl-matrix").vec3,i=b("gl-matrix").mat3;b("gl-matrix").mat4;a={tiledCubeMapStereographProject:function(a,b,c,d,e,f,j,k){__p&&__p();var l=1.1;e=g.fromValues(e,f);f=g.scale(g.create(),e,.5/l);e=f[0]*f[0]+f[1]*f[1];l=h.scale(h.create(),h.fromValues(2*f[0],2*f[1],e-1),1/(e+1));f=j[b];e=i.multiply(i.create(),f,i.fromMat4(i.create(),k));j=h.transformMat3(h.create(),l,e);if(j[2]>0)return g.fromValues(NaN,NaN);b=g.fromValues(.5*j[0]/j[2]+.5,-.5*j[1]/j[2]+.5);f=Math.pow(2,a);k=g.fromValues(b[0]*f-c,b[1]*f-d);return k},tiledCubeMapStereographUnproject:function(a,b,c,d,e,f){__p&&__p();e=e[b];b=i.multiply(i.create(),e,i.fromMat4(i.create(),f));e=i.invert(i.create(),b);f=Math.pow(2,a);b=2/f;a=h.fromValues(1-b*c,-1+b*d,-1);f=h.transformMat3(h.create(),a,e);h.normalize(f,f);c=f[0]/(1-f[2]);b=f[1]/(1-f[2]);d=1.1;a=c*d/.5;e=b*d/.5;return g.fromValues(a,e)},cubeMapTileIsInView:function(a,b,c,d,e,f,g,i){__p&&__p();var j=g[1][0],k=g[1][1],l=!1,m=[];for(var n=0;n<=1;n++)for(var o=0;o<=1;o++){var p=this.tiledCubeMapStereographUnproject(a,b,c+o,d+n,e,f),q=p[0];p=p[1];m.push([q,p]);q>-j&&q<j&&p>-k&&p<k&&(l=!0)}q=function(h,g){h=this.tiledCubeMapStereographProject(a,b,c,d,h,g,e,f);g=h[0];h=h[1];g&&h&&g>0&&g<1&&h>0&&h<1&&(l=!0)}.bind(this);l||q(-j,-k);l||q(j,-k);l||q(-j,k);l||q(j,k);l||q(0,0);l||q(.5*-j,.5*-k);l||q(.5*j,.5*-k);l||q(.5*-j,.5*k);l||q(.5*j,.5*k);p=h.length(h.subtract(h.create(),h.fromValues(m[0][0],m[0][1],0),h.fromValues(m[1][0],m[1][1],0)));o=h.length(h.subtract(h.create(),h.fromValues(m[1][0],m[1][1],0),h.fromValues(m[3][0],m[3][1],0)));n=h.length(h.subtract(h.create(),h.fromValues(m[3][0],m[3][1],0),h.fromValues(m[2][0],m[2][1],0)));q=h.length(h.subtract(h.create(),h.fromValues(m[2][0],m[2][1],0),h.fromValues(m[0][0],m[0][1],0)));j=i.width/(2*g[1][0]);k=Math.max(Math.max(p,o),Math.max(n,q))*j;return{inlier:l,longestSide:k}}};e.exports=a}),null);
__d("TileRendererState",["CubemapImageTileInfo"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=1e3,h=1e3;function a(a,b){this.tileInfo=a,this.blendingProgress=0,this.closestCoveringTile=b,this.closestPrevTile=b,this.durationInViewMS=0,this.isInView=!0}a.prototype.enterView=function(a){this.blendingProgress=1,this.closestCoveringTile=a,this.closestPrevTile=a,this.durationInViewMS=0,this.isInView=!0};a.prototype.exitView=function(){this.closestCoveringTile=null,this.closestPrevTile=null,this.isInView=!1};a.prototype.shouldFetch=function(a){return this.durationInViewMS<g&&this.durationInViewMS+a>=g};a.prototype.update=function(a,b){this.updateBlendingProgress(a,b),this.durationInViewMS+=a};a.prototype.updateBlendingProgress=function(a,b){if(!b||!this.closestCoveringTile)return;var c=b.level-this.closestCoveringTile.level;c>0&&(this.closestCoveringTile=b,this.blendingProgress=this.blendingProgress>=1?0:this.blendingProgress/(1*Math.pow(2,c)));this.blendingProgress<1&&(this.blendingProgress=Math.min(this.blendingProgress+1*a/h,1))};e.exports=a}),null);
__d("TiledSphericalRendererTextureCache",["TileRendererState","performanceNow"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b,c,d,e){this.TEXTURE_CACHE_LIMIT=a,this.$3=b,this.$5=d,this.$4=c,this.$6=e,this.$1=new Map(),this.$2=new Map()}a.prototype.createTexture=function(){this.$2.size===0&&this.$3.isBaseLevelReady()&&this.$7(),this.$1.size===0&&this.$3.isViewportReady()&&this.$8()};a.prototype.clearCache=function(){this.$2.forEach(function(a){this.$5.deleteTexture(a)}.bind(this)),this.$2.clear(),this.$1.forEach(function(a){this.$5.deleteTexture(a.texture)}.bind(this)),this.$1.clear()};a.prototype.cacheTexture=function(a){__p&&__p();var c=a.getInfo().getKey(),d=this.$1.get(c);if(!d){a=this.$6({image:a.getImg()},this.$5.TEXTURE_2D);d={texture:a,lastUsedTime:b("performanceNow")()};this.$1.set(c,d);if(this.$1.size>this.TEXTURE_CACHE_LIMIT){a=c;var e=d;this.$1.forEach(function(b,c){b.lastUsedTime<e.lastUsedTime&&(a=c,e=b)});this.$5.deleteTexture(e.texture);this.$1["delete"](a);this.$4["delete"](a)}}};a.prototype.getTextureCache=function(){return this.$1};a.prototype.getBaseLevelTexCache=function(){return this.$2};a.prototype.$7=function(){var a=this.$3.getBaseLevelImageTiles();a.forEach(function(a){var b=this.$6({image:a.getImg()},this.$5.TEXTURE_2D);this.$2.set(a.getInfo().getKey(),b)}.bind(this))};a.prototype.$8=function(){var a=this.$3.getViewportImageTiles();a.forEach(function(a){var c=this.$6({image:a.getImg()},this.$5.TEXTURE_2D);c={texture:c,lastUsedTime:b("performanceNow")()};this.$1.set(a.getInfo().getKey(),c)}.bind(this))};e.exports=a}),null);
__d("TiledSphericalRendererStats",["TiledSphericalRendererTextureCache"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b,c,d){this.$1=a,this.$2=b,this.$3=c,this.$4=d}a.prototype.getMaxGPUMemoryUsedBytes=function(){var a=this.$3.getTileTotalSize(),b=4,c=this.$2.getTextureCache().size+this.$2.getBaseLevelTexCache().size;return a*a*b*c};a.prototype.getTileToCanvasPixelRatio=function(a,b){b=this.$4.height/b;a=90/Math.pow(2,a);a=this.$3.getTileContentSize()/a;return a/b};e.exports=a}),null);
__d("TiledSphericalRendererUtils",["CubemapImageTileInfo","SphericalMediaConstants","gl-matrix"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalMediaConstants").TILED_CUBE_FACES,h=b("gl-matrix").glMatrix,i=b("gl-matrix").mat3,j=b("gl-matrix").mat4,k=b("gl-matrix").vec3;a={fetchImage:function(a,b,c,d,e,f){a=a;while(!b.has(a.getKey())&&!c.has(a.getKey()))d.loadTileImage(a,e,f),a=a.getInfoForOffsetLevel(1)},getLinePlaneIntersection:function(a,b,c,d){d=-b/(d-b);b=k.create();k.subtract(b,c,a);k.scale(b,b,d);k.add(b,b,a);return b},clipPolygon3D:function(a,b){__p&&__p();var c=b[b.length-1];for(var d=0;d<b.length;d++){var e=b[d],f=[],g=k.create();k.cross(g,c,e);var h=a[a.length-1],i=k.dot(g,h),j=i>=0;for(var l=0;l<a.length;l++){var m=a[l],n=k.dot(g,m),o=n>=0;if(o!==j){var p=this.getLinePlaneIntersection(h,i,m,n);!k.exactEquals(h,p)&&!k.exactEquals(m,p)&&f.push(p)}o&&f.push(m);h=m;i=n;j=o}a=f;if(a.length===0)break;c=e}return a},initFaceRotationMatrices:function(a){__p&&__p();var b=[],c=[],d=[],e=j.create();j.identity(e);j.rotateY(e,e,h.toRadian(-90));b[g.PLUS_X]=e;c[g.MINUS_X]=e;e=j.create();j.identity(e);j.rotateY(e,e,h.toRadian(90));b[g.MINUS_X]=e;c[g.PLUS_X]=e;e=j.create();j.identity(e);j.rotateZ(e,e,h.toRadian(-180));j.rotateX(e,e,h.toRadian(-90));b[g.PLUS_Y]=e;e=j.create();j.identity(e);j.rotateX(e,e,h.toRadian(90));c[g.PLUS_Y]=e;e=j.create();j.identity(e);j.rotateZ(e,e,h.toRadian(180));j.rotateX(e,e,h.toRadian(90));b[g.MINUS_Y]=e;e=j.create();j.identity(e);j.rotateX(e,e,h.toRadian(-90));c[g.MINUS_Y]=e;e=j.create();j.identity(e);j.rotateY(e,e,h.toRadian(180));b[g.PLUS_Z]=e;c[g.MINUS_Z]=e;e=j.create();j.identity(e);b[g.MINUS_Z]=e;c[g.PLUS_Z]=e;for(var e=0;e<6;e++)b[e]=i.fromMat4(i.create(),b[e]),c[e]=i.fromMat4(i.create(),c[e]);e=[k.fromValues(-a,a,-a),k.fromValues(a,a,-a),k.fromValues(a,-a,-a),k.fromValues(-a,-a,-a)];for(var a=0;a<6;a++){var f=b[a],l=[];for(var m=0;m<e.length;m++){var n=k.create();k.transformMat3(n,e[m],f);l.push(n)}d[a]=l}return{faceRotationMatrices:b,faceTransformMatrices:c,faceVertexLists:d}},rotateVec3s:function(a,b){for(var c=0;c<b.length;c++)k.transformMat3(b[c],b[c],a)}};e.exports=a}),null);
__d("TiledCubeMapStereoGraphRenderer",["BaseRotatableWebGLRenderer","CubemapImageTileInfo","StereographicProjectionUtils","TiledSphericalRendererStats","TiledSphericalRendererTextureCache","TiledSphericalRendererUtils","TileRendererState","gl-matrix","performanceNow","throttle"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("gl-matrix").glMatrix;b("gl-matrix").mat3;var i=b("gl-matrix").mat4,j=b("gl-matrix").vec3,k=120;c=babelHelpers.inherits(a,b("BaseRotatableWebGLRenderer"));g=c&&c.prototype;function a(a,c,d,e){__p&&__p();g.constructor.call(this,a),this.$TiledCubeMapStereoGraphRenderer41=function(a,b){var c=a.getInfo().getKey();this.$TiledCubeMapStereoGraphRenderer5.set(c,a);b!==this.$TiledCubeMapStereoGraphRenderer8&&(this.$TiledCubeMapStereoGraphRenderer8=this.$TiledCubeMapStereoGraphRenderer6,setTimeout(this.$TiledCubeMapStereoGraphRenderer42,0))}.bind(this),this.$TiledCubeMapStereoGraphRenderer37=b("throttle")(function(){return this.__renderInternal()}.bind(this),100),this.$TiledCubeMapStereoGraphRenderer42=b("throttle")(function(){var a=this.$TiledCubeMapStereoGraphRenderer5;this.$TiledCubeMapStereoGraphRenderer5=new Map();this.$TiledCubeMapStereoGraphRenderer32();this.$TiledCubeMapStereoGraphRenderer11.forEach(function(b){return setTimeout(function(){return this.$TiledCubeMapStereoGraphRenderer43(b,a)}.bind(this),0)}.bind(this))}.bind(this),100),this.$TiledCubeMapStereoGraphRenderer1=c,this.$TiledCubeMapStereoGraphRenderer2=d,this.$TiledCubeMapStereoGraphRenderer3=1,this.$TiledCubeMapStereoGraphRenderer4=0,this.$TiledCubeMapStereoGraphRenderer6=-1,this.$TiledCubeMapStereoGraphRenderer7=-1,this.$TiledCubeMapStereoGraphRenderer8=0,this.$TiledCubeMapStereoGraphRenderer5=new Map(),this.$TiledCubeMapStereoGraphRenderer10=[],this.$TiledCubeMapStereoGraphRenderer11=[],this.$TiledCubeMapStereoGraphRenderer12=new Map(),this.$TiledCubeMapStereoGraphRenderer13=[],this.$TiledCubeMapStereoGraphRenderer14=new Map(),this.$TiledCubeMapStereoGraphRenderer15=null,this.$TiledCubeMapStereoGraphRenderer27=0,this.__shouldEnableBlend=!0,this.__useVfovAsIs=!0,this.$TiledCubeMapStereoGraphRenderer28(),this.__setup(),this.$TiledCubeMapStereoGraphRenderer17=new(b("TiledSphericalRendererTextureCache"))(k,this.$TiledCubeMapStereoGraphRenderer1,this.$TiledCubeMapStereoGraphRenderer14,this.__gl,this.__copyTextureToGLBuffer.bind(this)),this.$TiledCubeMapStereoGraphRenderer16=new(b("TiledSphericalRendererStats"))(d,this.$TiledCubeMapStereoGraphRenderer17,this.$TiledCubeMapStereoGraphRenderer1,this.__canvas)}a.prototype.updateDebugTileGradation=function(a){this.$TiledCubeMapStereoGraphRenderer27=Math.min(Math.max(a,0),1)};a.prototype.__clearCache=function(){this.$TiledCubeMapStereoGraphRenderer29(),this.$TiledCubeMapStereoGraphRenderer13=[],this.$TiledCubeMapStereoGraphRenderer17.clearCache(),this.$TiledCubeMapStereoGraphRenderer14.clear()};a.prototype.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};a.prototype.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};a.prototype.__shaderProgramReady=function(){__p&&__p();this.$TiledCubeMapStereoGraphRenderer19=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$TiledCubeMapStereoGraphRenderer19);var a=this.__gl.getUniformLocation(this.__shaderProgram,"uContentSampler"),b=0;this.$TiledCubeMapStereoGraphRenderer20=this.__gl.TEXTURE0;this.__gl.uniform1i(a,b);this.$TiledCubeMapStereoGraphRenderer23=this.__gl.getUniformLocation(this.__shaderProgram,"tilesPerEdge");this.$TiledCubeMapStereoGraphRenderer24=this.__gl.getUniformLocation(this.__shaderProgram,"row");this.$TiledCubeMapStereoGraphRenderer25=this.__gl.getUniformLocation(this.__shaderProgram,"col");this.$TiledCubeMapStereoGraphRenderer26=this.__gl.getUniformLocation(this.__shaderProgram,"debugTileGradation");this.$TiledCubeMapStereoGraphRenderer30()};a.prototype.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat3 uFaceTransformMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp mat3 vFaceRotationMatrix;\n\n      void main(void) {\n        gl_Position = uPMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vFaceRotationMatrix = uFaceTransformMatrix * mat3(uRotationMatrix);\n      }\n    "};a.prototype.__getFragmentShaderScript=function(){return"\n      precision highp float;\n      const highp float DEFAULT_ZOOM = 1.1;\n\n      varying highp mat3 vFaceRotationMatrix;\n      varying highp vec3 vCurrentRay;\n\n      uniform sampler2D uContentSampler;\n\n      uniform float tilesPerEdge;\n      uniform float row;\n      uniform float col;\n      uniform float debugTileGradation;\n\n      void main(void) {\n        vec2 p = (vCurrentRay.xy * 0.5) / DEFAULT_ZOOM;\n        float pp = p.x*p.x + p.y*p.y;\n        vec3 cartesian = vec3(2.0*p, pp - 1.0) / (pp + 1.0);\n        vec3 faceVertex = vFaceRotationMatrix * cartesian;\n\n        // First compute global tex coords then convert them to local tile coords.\n        vec2 globalTexCoords = faceVertex.xy * vec2(1.0, -1.0) / faceVertex.z * 0.5 + 0.5;\n        vec2 texCoords = (globalTexCoords * tilesPerEdge - vec2(col, row)) * (510.0 / 512.0) + (1.0 / 512.0);\n\n        // If tile is behind us (+z) or outside of the tile, render transparent.\n        if (faceVertex.z > 0.0 ||\n          texCoords.s > 1.0 || texCoords.s < 0.0 || texCoords.t > 1.0 || texCoords.t < 0.0) {\n          gl_FragColor = vec4(0, 0, 0, 0);\n        } else {\n          gl_FragColor = mix(texture2D(uContentSampler, texCoords), vec4(texCoords, 1, 1), debugTileGradation);\n        }\n      }\n    "};a.prototype.__getMaxGPUMemoryUsedBytes=function(){return this.$TiledCubeMapStereoGraphRenderer16.getMaxGPUMemoryUsedBytes()};a.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$TiledCubeMapStereoGraphRenderer4};a.prototype.__createTexture=function(){this.$TiledCubeMapStereoGraphRenderer17.createTexture()};a.prototype.__renderInternal=function(){__p&&__p();if(this.__destroyed||!this.$TiledCubeMapStereoGraphRenderer1.isBaseLevelReady()&&!this.$TiledCubeMapStereoGraphRenderer1.isViewportReady())return;this.__createTexture();i.identity(this.__rotationMatrix);i.rotateX(this.__rotationMatrix,this.__rotationMatrix,h.toRadian(180));i.rotateY(this.__rotationMatrix,this.__rotationMatrix,h.toRadian(-this.__view.yaw));i.rotateX(this.__rotationMatrix,this.__rotationMatrix,h.toRadian(this.__view.pitch));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,!1,this.__rotationMatrix);this.$TiledCubeMapStereoGraphRenderer31();var a=this.$TiledCubeMapStereoGraphRenderer9,c=a[1][0];a=a[1][1];var d=2;this.__perspectiveMatrix=i.create();i.ortho(this.__perspectiveMatrix,-c,c,-a,a,-d,d);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__perspectiveMatrix);this.$TiledCubeMapStereoGraphRenderer7=this.$TiledCubeMapStereoGraphRenderer6!=-1?this.$TiledCubeMapStereoGraphRenderer6:b("performanceNow")();this.$TiledCubeMapStereoGraphRenderer6=b("performanceNow")();this.$TiledCubeMapStereoGraphRenderer32();this.$TiledCubeMapStereoGraphRenderer11=this.$TiledCubeMapStereoGraphRenderer11.map(function(a){return this.$TiledCubeMapStereoGraphRenderer33(a)}.bind(this));this.$TiledCubeMapStereoGraphRenderer34();this.$TiledCubeMapStereoGraphRenderer11.sort(function(a,b){var c=function(a){return a.level*1e3+a.face*100+a.col*10+a.row};return c(a)-c(b)});var e=0;c=!1;this.$TiledCubeMapStereoGraphRenderer11.forEach(function(a){var b=this.$TiledCubeMapStereoGraphRenderer14.get(a.getKey());b=b?b.blendingProgress:0;b<1&&(c=!0);e+=this.$TiledCubeMapStereoGraphRenderer35(a)}.bind(this));a=this.$TiledCubeMapStereoGraphRenderer11.length>0?this.$TiledCubeMapStereoGraphRenderer11.length:1;e/=a;this.$TiledCubeMapStereoGraphRenderer4=e;c?this.$TiledCubeMapStereoGraphRenderer36():this.$TiledCubeMapStereoGraphRenderer29()};a.prototype.$TiledCubeMapStereoGraphRenderer36=function(){this.$TiledCubeMapStereoGraphRenderer15===null&&(this.$TiledCubeMapStereoGraphRenderer15=setInterval(function(){return this.$TiledCubeMapStereoGraphRenderer37()}.bind(this),200))};a.prototype.$TiledCubeMapStereoGraphRenderer29=function(){this.$TiledCubeMapStereoGraphRenderer15!==null&&(clearInterval(this.$TiledCubeMapStereoGraphRenderer15),this.$TiledCubeMapStereoGraphRenderer15=null)};a.prototype.$TiledCubeMapStereoGraphRenderer30=function(){var a=this.__gl.getUniformLocation(this.__shaderProgram,"uHorizontalAngleBounds"),b=this.__gl.getUniformLocation(this.__shaderProgram,"uVerticleAngleBounds"),c=this.$TiledCubeMapStereoGraphRenderer2.partialLeftDegrees,d=this.$TiledCubeMapStereoGraphRenderer2.partialRightDegrees,e=this.$TiledCubeMapStereoGraphRenderer2.partialTopDegrees,f=this.$TiledCubeMapStereoGraphRenderer2.partialBottomDegrees;c=c!==void 0&&c!==null?-1*c:-181;d=d!==void 0&&d!==null?d:181;f=f!==void 0&&f!==null?-1*f:-91;e=e!==void 0&&e!==null?e:91;c=new Float32Array([h.toRadian(c),h.toRadian(d)]);d=new Float32Array([h.toRadian(f),h.toRadian(e)]);this.__gl.uniform2fv(a,c);this.__gl.uniform2fv(b,d)};a.prototype.$TiledCubeMapStereoGraphRenderer38=function(a,c,d,e){a=new(b("CubemapImageTileInfo"))(a,c,d,e);this.$TiledCubeMapStereoGraphRenderer11.push(a);this.$TiledCubeMapStereoGraphRenderer12.set(a.getKey(),!0)};a.prototype.$TiledCubeMapStereoGraphRenderer39=function(a,c,d,e){__p&&__p();c===void 0&&(c=0);d===void 0&&(d=0);e===void 0&&(e=0);var f={requireParentTile:!1};if(!this.$TiledCubeMapStereoGraphRenderer9){this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e);return f}var g=b("StereographicProjectionUtils").cubeMapTileIsInView(c,a,d,e,this.$TiledCubeMapStereoGraphRenderer18,this.__rotationMatrix,this.$TiledCubeMapStereoGraphRenderer9,this.__canvas);if(g.inlier){c===0&&this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e);var h=.5;if(2*h*g.longestSide<512){c>0&&(f.requireParentTile=!0);return f}else if(h*g.longestSide<512){this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e);return f}if(c===this.$TiledCubeMapStereoGraphRenderer1.getMaxTileLevel()){this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e);return f}h=!1;for(var g=0;g<=1;g++)for(var i=0;i<=1;i++){var j=this.$TiledCubeMapStereoGraphRenderer39(a,c+1,2*d+g,2*e+i);j.requireParentTile&&(h=!0)}h&&this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e)}return f};a.prototype.$TiledCubeMapStereoGraphRenderer32=function(){__p&&__p();this.$TiledCubeMapStereoGraphRenderer11=[];this.$TiledCubeMapStereoGraphRenderer12.clear();var a=0,b=this.$TiledCubeMapStereoGraphRenderer1.getMaxTileLevel();while(this.$TiledCubeMapStereoGraphRenderer11.length===0&&a<=b){for(var c=0;c<6;c++)for(var d=0;d<=a;d++)for(var e=0;e<=a;e++)this.$TiledCubeMapStereoGraphRenderer39(c,a,d,e);a+=1}};a.prototype.$TiledCubeMapStereoGraphRenderer34=function(){__p&&__p();this.$TiledCubeMapStereoGraphRenderer13.forEach(function(a){a=a.getKey();if(!this.$TiledCubeMapStereoGraphRenderer12.has(a)){a=this.$TiledCubeMapStereoGraphRenderer14.get(a);a&&a.exitView()}}.bind(this)),this.$TiledCubeMapStereoGraphRenderer13=[],this.$TiledCubeMapStereoGraphRenderer11.forEach(function(a){__p&&__p();this.$TiledCubeMapStereoGraphRenderer13.push(a);var c=a.getKey(),d=this.$TiledCubeMapStereoGraphRenderer14.get(c),e=this.$TiledCubeMapStereoGraphRenderer40(a);if(!d)d=new(b("TileRendererState"))(a,e),this.$TiledCubeMapStereoGraphRenderer14.set(c,d);else if(!d.isInView)d.enterView(e);else{c=this.$TiledCubeMapStereoGraphRenderer6-this.$TiledCubeMapStereoGraphRenderer7;d.shouldFetch(c)&&b("TiledSphericalRendererUtils").fetchImage(a,this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache(),this.$TiledCubeMapStereoGraphRenderer17.getTextureCache(),this.$TiledCubeMapStereoGraphRenderer1,this.$TiledCubeMapStereoGraphRenderer41,this.$TiledCubeMapStereoGraphRenderer6);d.update(c,e)}}.bind(this))};a.prototype.$TiledCubeMapStereoGraphRenderer31=function(){var a=h.toRadian(this.__verticalFieldOfView),b=h.toRadian(this.__horizontalFieldOfView);b=Math.tan(b/2);a=Math.tan(a/2);this.$TiledCubeMapStereoGraphRenderer9=[j.fromValues(-b,a,-1),j.fromValues(b,a,-1),j.fromValues(b,-a,-1),j.fromValues(-b,-a,-1)]};a.prototype.$TiledCubeMapStereoGraphRenderer43=function(a,b){a=a.getKey();b=b.get(a);b&&(this.$TiledCubeMapStereoGraphRenderer17.cacheTexture(b),this.$TiledCubeMapStereoGraphRenderer37())};a.prototype.$TiledCubeMapStereoGraphRenderer35=function(a){__p&&__p();var b=a.getKey();b=this.$TiledCubeMapStereoGraphRenderer14.get(b);if(!b)return 0;b=this.__gl.getUniformLocation(this.__shaderProgram,"uFaceTransformMatrix");this.__gl.uniformMatrix3fv(b,!1,this.$TiledCubeMapStereoGraphRenderer18[a.face]);b=this.$TiledCubeMapStereoGraphRenderer9;b=[b[1][0],b[1][1],-1,b[0][0],b[0][1],-1,b[2][0],b[2][1],-1,b[3][0],b[3][1],-1];this.$TiledCubeMapStereoGraphRenderer44(this.$TiledCubeMapStereoGraphRenderer19,b,3);this.__gl.activeTexture(this.$TiledCubeMapStereoGraphRenderer20);this.$TiledCubeMapStereoGraphRenderer45(a);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer23,Math.pow(2,a.level));this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer24,a.row);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer25,a.col);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer26,this.$TiledCubeMapStereoGraphRenderer27);this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,b.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledCubeMapStereoGraphRenderer10.forEach(function(a){this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,a),this.__gl.bufferData(this.__gl.ARRAY_BUFFER,1,this.__gl.STATIC_DRAW),this.__gl.deleteBuffer(a)}.bind(this));this.$TiledCubeMapStereoGraphRenderer10=[];return this.$TiledCubeMapStereoGraphRenderer16.getTileToCanvasPixelRatio(a.level,this.__verticalFieldOfView)};a.prototype.$TiledCubeMapStereoGraphRenderer44=function(a,b,c){var d=this.__gl.createBuffer();this.$TiledCubeMapStereoGraphRenderer10.push(d);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,d);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(b),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(a,c,this.__gl.FLOAT,!1,0,0)};a.prototype.$TiledCubeMapStereoGraphRenderer45=function(a){var b;a.level===0?b={lastUsedTime:0,texture:this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().get(a.getKey())}:b=this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().get(a.getKey());if(b){this.__gl.bindTexture(this.__gl.TEXTURE_2D,b.texture);b.lastUsedTime=this.$TiledCubeMapStereoGraphRenderer6;return a}throw new Error("No possible tile for requested params: "+a.getKey())};a.prototype.$TiledCubeMapStereoGraphRenderer33=function(a){__p&&__p();var b=0;while(b<=a.level){var c=a.getInfoForOffsetLevel(b),d=c.getKey(),e;c.level===0?e={lastUsedTime:0,texture:this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().get(d)}:e=this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().get(d);if(e){e.lastUsedTime=this.$TiledCubeMapStereoGraphRenderer6;return c}b===0&&this.$TiledCubeMapStereoGraphRenderer1.loadTileImage(c,this.$TiledCubeMapStereoGraphRenderer41,this.$TiledCubeMapStereoGraphRenderer6);b++}throw new Error("No possible tile for requested params: "+a.getKey())};a.prototype.$TiledCubeMapStereoGraphRenderer40=function(a){var b=0;while(b<=a.level){var c=a.getInfoForOffsetLevel(b),d=c.getKey();if(this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().has(d)||this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().has(d))return c;b++}throw new Error("No possible tile for requested params: "+a.getKey())};a.prototype.$TiledCubeMapStereoGraphRenderer28=function(){var a=b("TiledSphericalRendererUtils").initFaceRotationMatrices(this.$TiledCubeMapStereoGraphRenderer3);a=a.faceTransformMatrices;this.$TiledCubeMapStereoGraphRenderer18=a};a.__subClassMethods={__getFragmentShaderScript:!0,__getVertexShaderScript:!0,__getShaderPerspectiveMatrixUniformName:!0,__getShaderRotationMatrixUniformName:!0,__renderInternal:!0,__shaderProgramReady:!0,__getMaxGPUMemoryUsedBytes:!0,__getPrevFrameTextureScreenRatio:!0,__createTexture:!0,__clearCache:!0};e.exports=a}),null);
__d("TiledSphericalRenderer",["BaseRotatableWebGLRenderer","CubemapImageTileInfo","TiledSphericalRendererStats","TiledSphericalRendererTextureCache","TiledSphericalRendererUtils","TileRendererState","debounceCore","gl-matrix","performanceNow","throttle"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("gl-matrix").glMatrix,i=b("gl-matrix").mat3,j=b("gl-matrix").vec3,k=44;c=babelHelpers.inherits(a,b("BaseRotatableWebGLRenderer"));g=c&&c.prototype;function a(a,c,d,e){__p&&__p();g.constructor.call(this,a),this.$TiledSphericalRenderer37=function(a,b){var c=a.getInfo().getKey();this.$TiledSphericalRenderer5.set(c,a);b!==this.$TiledSphericalRenderer8&&(this.$TiledSphericalRenderer8=this.$TiledSphericalRenderer6,setTimeout(this.$TiledSphericalRenderer38,0))}.bind(this),this.$TiledSphericalRenderer39=b("debounceCore")(function(){return this.__renderInternal()}.bind(this),30),this.$TiledSphericalRenderer33=b("throttle")(function(){return this.__renderInternal()}.bind(this),100),this.$TiledSphericalRenderer41=b("debounceCore")(function(){var a=this.$TiledSphericalRenderer5;this.$TiledSphericalRenderer5=new Map();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer10.forEach(function(b){return setTimeout(function(){return this.$TiledSphericalRenderer40(b,a)}.bind(this),0)}.bind(this))}.bind(this),100),this.$TiledSphericalRenderer38=b("throttle")(function(){var a=this.$TiledSphericalRenderer5;this.$TiledSphericalRenderer5=new Map();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer10.forEach(function(b){return setTimeout(function(){return this.$TiledSphericalRenderer40(b,a)}.bind(this),0)}.bind(this))}.bind(this),100),this.$TiledSphericalRenderer1=c,this.$TiledSphericalRenderer2=d,this.$TiledSphericalRenderer3=1,this.$TiledSphericalRenderer4=0,this.$TiledSphericalRenderer6=-1,this.$TiledSphericalRenderer7=-1,this.$TiledSphericalRenderer8=0,this.$TiledSphericalRenderer5=new Map(),this.$TiledSphericalRenderer9=[],this.$TiledSphericalRenderer10=[],this.$TiledSphericalRenderer11=new Map(),this.$TiledSphericalRenderer12=[],this.$TiledSphericalRenderer13=new Map(),this.$TiledSphericalRenderer14=null,this.$TiledSphericalRenderer26(),this.__setup(),this.$TiledSphericalRenderer16=new(b("TiledSphericalRendererTextureCache"))(k,this.$TiledSphericalRenderer1,this.$TiledSphericalRenderer13,this.__gl,this.__copyTextureToGLBuffer.bind(this)),this.$TiledSphericalRenderer15=new(b("TiledSphericalRendererStats"))(d,this.$TiledSphericalRenderer16,this.$TiledSphericalRenderer1,this.__canvas)}a.prototype.__clearCache=function(){this.$TiledSphericalRenderer27(),this.$TiledSphericalRenderer12=[],this.$TiledSphericalRenderer16.clearCache(),this.$TiledSphericalRenderer13.clear()};a.prototype.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};a.prototype.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};a.prototype.__shaderProgramReady=function(){__p&&__p();this.$TiledSphericalRenderer19=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer19);this.$TiledSphericalRenderer20=this.__gl.getAttribLocation(this.__shaderProgram,"aTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer20);this.$TiledSphericalRenderer21=this.__gl.getAttribLocation(this.__shaderProgram,"aBGTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer21);var a=this.__gl.getUniformLocation(this.__shaderProgram,"uContentSampler"),b=this.__gl.getUniformLocation(this.__shaderProgram,"uBackgroundSampler"),c=0;this.$TiledSphericalRenderer23=this.__gl.TEXTURE0;var d=1;this.$TiledSphericalRenderer24=this.__gl.TEXTURE1;this.__gl.uniform1i(a,c);this.__gl.uniform1i(b,d);this.$TiledSphericalRenderer22=this.__gl.getAttribLocation(this.__shaderProgram,"aPrevLevelTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer22);a=this.__gl.getUniformLocation(this.__shaderProgram,"uPrevLevelSampler");c=2;this.$TiledSphericalRenderer25=this.__gl.TEXTURE2;this.__gl.uniform1i(a,c);this.$TiledSphericalRenderer28()};a.prototype.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n      attribute vec2 aTextureCoord;\n      attribute vec2 aBGTextureCoord;\n      attribute vec2 aPrevLevelTextureCoord;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vTextureCoord = aTextureCoord;\n        vBGTextureCoord = aBGTextureCoord;\n        vPrevLevelTextureCoord = aPrevLevelTextureCoord;\n      }\n    "};a.prototype.__getFragmentShaderScript=function(){return"\n      #define PI 3.1415926538\n\n      precision highp float;\n      // 1 degree blend zone\n      const highp float blendDist = PI / 180.0;\n\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      varying highp vec3 vCurrentRay;\n      uniform highp vec2 uHorizontalAngleBounds;\n      uniform highp vec2 uVerticleAngleBounds;\n\n      uniform sampler2D uContentSampler;\n      uniform sampler2D uBackgroundSampler;\n      uniform sampler2D uPrevLevelSampler;\n\n      uniform float progress;\n\n      void main(void) {\n        highp float x = vCurrentRay[0];\n        highp float y = vCurrentRay[1];\n        highp float z = vCurrentRay[2];\n        highp float hAngle = atan(x, -1.0 * z);\n        highp float vAngle = atan(y * inversesqrt(x*x + z*z));\n\n        // if current ray is inside the content bounds, use the content sampler\n        // to set the fragment color. if it is not within the bounds, use the\n        // background sampler to set the color.*\n\n        highp float hdist = 0.0;\n        highp float vdist = 0.0;\n        if (hAngle < uHorizontalAngleBounds[0]) {\n          hdist = uHorizontalAngleBounds[0] - hAngle;\n        } else if (hAngle > uHorizontalAngleBounds[1]) {\n          hdist = hAngle - uHorizontalAngleBounds[1];\n        }\n        if (vAngle < uVerticleAngleBounds[0]) {\n          vdist = uVerticleAngleBounds[0] - vAngle;\n        } else if (vAngle > uVerticleAngleBounds[1]) {\n          vdist = vAngle - uVerticleAngleBounds[1];\n        }\n        highp float maxDist = max(hdist, vdist);\n        highp vec4 bgColor = texture2D(\n          uBackgroundSampler,\n          vec2(vBGTextureCoord.s, vBGTextureCoord.t)\n        );\n        highp vec4 contentColor = texture2D(\n          uContentSampler,\n          vec2(vTextureCoord.s, vTextureCoord.t)\n        );\n        if (maxDist > 0.0) {\n          // Inside this condition, our fragment is outside the content bounds.\n          // The distance outside the bound is represented by maxDist. It could\n          // be the horizontal or vertical distance from a bound, whichever is\n          // larger. We will use this distance to blend the content with the\n          // background, if the distance is smaller than blendDist. If it is\n          // larger than blendDist, we will use purely the background tex to\n          // set the color. If dist is within the blendDist, then we will set\n          // the color to the linearly weighted avg across the blend zone of the\n          // background and content colors.\n          //\n          if (maxDist < blendDist) {\n            highp float contentWeight = (blendDist - maxDist) / blendDist;\n            gl_FragColor = mix(bgColor, contentColor, contentWeight);\n          } else {\n            // We are outside the blend zone. Just use background.\n            gl_FragColor = bgColor;\n          }\n        } else {\n          // In this condition, we are inside the content\n          highp vec4 prevLevelColor = texture2D(\n            uPrevLevelSampler,\n            vec2(vPrevLevelTextureCoord.s, vPrevLevelTextureCoord.t)\n          );\n          gl_FragColor = mix(prevLevelColor, contentColor, progress);\n        }\n      }\n      "};a.prototype.__getMaxGPUMemoryUsedBytes=function(){return this.$TiledSphericalRenderer15.getMaxGPUMemoryUsedBytes()};a.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$TiledSphericalRenderer4};a.prototype.__createTexture=function(){this.$TiledSphericalRenderer16.createTexture()};a.prototype.__renderInternal=function(){__p&&__p();if(this.__destroyed||!this.$TiledSphericalRenderer1.isBaseLevelReady()&&!this.$TiledSphericalRenderer1.isViewportReady())return;this.__createTexture();this.$TiledSphericalRenderer7=this.$TiledSphericalRenderer6!=-1?this.$TiledSphericalRenderer6:b("performanceNow")();this.$TiledSphericalRenderer6=b("performanceNow")();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer30();var a=0,c=!1;this.$TiledSphericalRenderer10.forEach(function(b){var d=this.$TiledSphericalRenderer13.get(b.getKey());d=d?d.blendingProgress:0;d<1&&(c=!0);a+=this.$TiledSphericalRenderer31(b)}.bind(this));var d=this.$TiledSphericalRenderer10.length>0?this.$TiledSphericalRenderer10.length:1;a/=d;this.$TiledSphericalRenderer4=a;c?this.$TiledSphericalRenderer32():this.$TiledSphericalRenderer27()};a.prototype.$TiledSphericalRenderer32=function(){this.$TiledSphericalRenderer14===null&&(this.$TiledSphericalRenderer14=setInterval(function(){return this.$TiledSphericalRenderer33()}.bind(this),200))};a.prototype.$TiledSphericalRenderer27=function(){this.$TiledSphericalRenderer14!==null&&(clearInterval(this.$TiledSphericalRenderer14),this.$TiledSphericalRenderer14=null)};a.prototype.$TiledSphericalRenderer28=function(){var a=this.__gl.getUniformLocation(this.__shaderProgram,"uHorizontalAngleBounds"),b=this.__gl.getUniformLocation(this.__shaderProgram,"uVerticleAngleBounds"),c=this.$TiledSphericalRenderer2.partialLeftDegrees,d=this.$TiledSphericalRenderer2.partialRightDegrees,e=this.$TiledSphericalRenderer2.partialTopDegrees,f=this.$TiledSphericalRenderer2.partialBottomDegrees;c=c!==void 0&&c!==null?-1*c:-181;d=d!==void 0&&d!==null?d:181;f=f!==void 0&&f!==null?-1*f:-91;e=e!==void 0&&e!==null?e:91;c=new Float32Array([h.toRadian(c),h.toRadian(d)]);d=new Float32Array([h.toRadian(f),h.toRadian(e)]);this.__gl.uniform2fv(a,c);this.__gl.uniform2fv(b,d)};a.prototype.$TiledSphericalRenderer29=function(){__p&&__p();this.$TiledSphericalRenderer10=[];this.$TiledSphericalRenderer11.clear();var a=this.$TiledSphericalRenderer34(),c=this.$TiledSphericalRenderer35(),d=Math.pow(2,a),e=2*this.$TiledSphericalRenderer3/d;for(var f=0;f<c.length;f++){var g=c[f];if(g){var h=Math.floor(g.minX/e),i=Math.min(Math.floor(g.maxX/e),d-1),j=Math.floor(g.minY/e);g=Math.min(Math.floor(g.maxY/e),d-1);for(var h=h;h<=i;h++)for(var k=j;k<=g;k++){var l=new(b("CubemapImageTileInfo"))(a,f,h,k);this.$TiledSphericalRenderer10.push(l);this.$TiledSphericalRenderer11.set(l.getKey(),!0)}}}};a.prototype.$TiledSphericalRenderer30=function(){__p&&__p();this.$TiledSphericalRenderer12.forEach(function(a){a=a.getKey();if(!this.$TiledSphericalRenderer11.has(a)){a=this.$TiledSphericalRenderer13.get(a);a&&a.exitView()}}.bind(this)),this.$TiledSphericalRenderer12=[],this.$TiledSphericalRenderer10.forEach(function(a){__p&&__p();this.$TiledSphericalRenderer12.push(a);var c=a.getKey(),d=this.$TiledSphericalRenderer13.get(c),e=this.$TiledSphericalRenderer36(a);if(!d)d=new(b("TileRendererState"))(a,e),this.$TiledSphericalRenderer13.set(c,d);else if(!d.isInView)d.enterView(e);else{c=this.$TiledSphericalRenderer6-this.$TiledSphericalRenderer7;d.shouldFetch(c)&&b("TiledSphericalRendererUtils").fetchImage(a,this.$TiledSphericalRenderer16.getBaseLevelTexCache(),this.$TiledSphericalRenderer16.getTextureCache(),this.$TiledSphericalRenderer1,this.$TiledSphericalRenderer37,this.$TiledSphericalRenderer6);d.update(c,e)}}.bind(this))};a.prototype.$TiledSphericalRenderer34=function(){var a=this.__verticalFieldOfView,b=this.__horizontalFieldOfView,c=this.__canvas.height/a,d=3400/2,e=0,f=this.$TiledSphericalRenderer1.getTileContentSize()/90,g=1.4;while(f*g<c&&f*a<d&&f*b<d)e++,f*=2;return Math.min(e,this.$TiledSphericalRenderer1.getMaxTileLevel())};a.prototype.$TiledSphericalRenderer35=function(){__p&&__p();var a=h.toRadian(this.__verticalFieldOfView),c=h.toRadian(this.__horizontalFieldOfView),d=1;c=Math.tan(c/2)*d;a=Math.tan(a/2)*d;c=[j.fromValues(-c,a,-d),j.fromValues(c,a,-d),j.fromValues(c,-a,-d),j.fromValues(-c,-a,-d)];a=i.create();i.transpose(a,i.fromMat4(i.create(),this.__rotationMatrix));b("TiledSphericalRendererUtils").rotateVec3s(a,c);d=[];for(var a=0;a<6;a++){var e=this.$TiledSphericalRenderer18[a],f=[];for(var g=0;g<e.length;g++)f.push(j.clone(e[g]));e=b("TiledSphericalRendererUtils").clipPolygon3D(f,c);if(e.length>0){g=i.create();i.transpose(g,this.$TiledSphericalRenderer17[a]);b("TiledSphericalRendererUtils").rotateVec3s(g,e);f=e[0];g=f[0];var k=f[0],l=f[1],m=f[1];for(var n=1;n<e.length;n++)f=e[n],g=Math.min(g,f[0]),k=Math.max(k,f[0]),l=Math.min(l,f[1]),m=Math.max(m,f[1]);d[a]={minX:this.$TiledSphericalRenderer3+g,maxX:this.$TiledSphericalRenderer3+k,minY:this.$TiledSphericalRenderer3-m,maxY:this.$TiledSphericalRenderer3-l}}}return d};a.prototype.$TiledSphericalRenderer40=function(a,b){a=a.getKey();b=b.get(a);b&&(this.$TiledSphericalRenderer16.cacheTexture(b),this.$TiledSphericalRenderer33())};a.prototype.$TiledSphericalRenderer31=function(a){__p&&__p();var c=a.getKey(),d,e;c=this.$TiledSphericalRenderer13.get(c);if(!c)return 0;d=c.closestCoveringTile;e=c.closestPrevTile;if(!d||!e)return 0;var f=2*this.$TiledSphericalRenderer3,g=this.$TiledSphericalRenderer3,h=Math.pow(2,a.level);f=f/h;h=a.col*f;var i=a.row*f;h=-g+h;var k=h+f;i=g-i;f=i-f;i=[[h,i,-g],[k,i,-g],[h,f,-g],[k,f,-g]];h=this.$TiledSphericalRenderer17[a.face];k=[];for(var f=0;f<i.length;f++)j.transformMat3(i[f],i[f],h),k.push(i[f][0]),k.push(i[f][1]),k.push(i[f][2]);g={};this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer19,k,3);this.__gl.activeTexture(this.$TiledSphericalRenderer23);d?g=this.$TiledSphericalRenderer43(d):g=this.$TiledSphericalRenderer44(a);f=this.$TiledSphericalRenderer45(a,g);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer20,f,2);this.__gl.activeTexture(this.$TiledSphericalRenderer24);h=new(b("CubemapImageTileInfo"))(0,a.face,0,0);i=this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(h.getKey());if(!i)throw new Error("[Tile] Base level should have been loaded.");this.__gl.bindTexture(this.__gl.TEXTURE_2D,i);d=this.$TiledSphericalRenderer45(a,h);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer21,d,2);if(c&&e){this.__gl.activeTexture(this.$TiledSphericalRenderer25);g=this.$TiledSphericalRenderer43(e);f=this.$TiledSphericalRenderer45(a,g);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer22,f,2);i=this.__gl.getUniformLocation(this.__shaderProgram,"progress");this.__gl.uniform1f(i,c.blendingProgress)}this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,k.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledSphericalRenderer9.forEach(function(a){this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,a),this.__gl.bufferData(this.__gl.ARRAY_BUFFER,1,this.__gl.STATIC_DRAW),this.__gl.deleteBuffer(a)}.bind(this));this.$TiledSphericalRenderer9=[];return this.$TiledSphericalRenderer15.getTileToCanvasPixelRatio(g.level,this.__verticalFieldOfView)};a.prototype.$TiledSphericalRenderer42=function(a,b,c){var d=this.__gl.createBuffer();this.$TiledSphericalRenderer9.push(d);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,d);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(b),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(a,c,this.__gl.FLOAT,!1,0,0)};a.prototype.$TiledSphericalRenderer45=function(a,b){var c=this.$TiledSphericalRenderer1.getTilePaddingPixels();c=c/this.$TiledSphericalRenderer1.getTileTotalSize();var d=this.$TiledSphericalRenderer1.getTileContentSize()/this.$TiledSphericalRenderer1.getTileTotalSize(),e=Math.pow(2,a.level-b.level);d=d/e;var f=a.col-e*b.col;a=a.row-e*b.row;e=c+f*d;b=c+a*d;return[e,b,e+d,b,e,b+d,e+d,b+d]};a.prototype.$TiledSphericalRenderer43=function(a){var b;a.level===0?b={lastUsedTime:0,texture:this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(a.getKey())}:b=this.$TiledSphericalRenderer16.getTextureCache().get(a.getKey());if(b){this.__gl.bindTexture(this.__gl.TEXTURE_2D,b.texture);b.lastUsedTime=this.$TiledSphericalRenderer6;return a}throw new Error("No possible tile for requested params: "+a.getKey())};a.prototype.$TiledSphericalRenderer44=function(a){__p&&__p();var b=0;while(b<=a.level){var c=a.getInfoForOffsetLevel(b),d=c.getKey(),e=void 0;c.level===0?e={lastUsedTime:0,texture:this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(d)}:e=this.$TiledSphericalRenderer16.getTextureCache().get(d);if(e){this.__gl.bindTexture(this.__gl.TEXTURE_2D,e.texture);e.lastUsedTime=this.$TiledSphericalRenderer6;return c}else this.$TiledSphericalRenderer1.loadTileImage(c,this.$TiledSphericalRenderer37,this.$TiledSphericalRenderer6);b++}throw new Error("No possible tile for requested params: "+a.getKey())};a.prototype.$TiledSphericalRenderer36=function(a){var b=0;while(b<=a.level){var c=a.getInfoForOffsetLevel(b),d=c.getKey();if(this.$TiledSphericalRenderer16.getBaseLevelTexCache().has(d)||this.$TiledSphericalRenderer16.getTextureCache().has(d))return c;b++}throw new Error("No possible tile for requested params: "+a.getKey())};a.prototype.$TiledSphericalRenderer26=function(){var a=b("TiledSphericalRendererUtils").initFaceRotationMatrices(this.$TiledSphericalRenderer3),c=a.faceRotationMatrices;a=a.faceVertexLists;this.$TiledSphericalRenderer17=c;this.$TiledSphericalRenderer18=a};a.__subClassMethods={__getFragmentShaderScript:!0,__getVertexShaderScript:!0,__getShaderPerspectiveMatrixUniformName:!0,__getShaderRotationMatrixUniformName:!0,__renderInternal:!0,__shaderProgramReady:!0,__getMaxGPUMemoryUsedBytes:!0,__getPrevFrameTextureScreenRatio:!0,__createTexture:!0,__clearCache:!0};e.exports=a}),null);
__d("getScaledPanoDimensions",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b){__p&&__p();a={croppedAreaImageHeightPixels:Number(a.CroppedAreaImageHeightPixels)||0,croppedAreaImageWidthPixels:Number(a.CroppedAreaImageWidthPixels)||0,croppedAreaLeftPixels:Number(a.CroppedAreaLeftPixels)||0,croppedAreaTopPixels:Number(a.CroppedAreaTopPixels)||0,fullPanoHeightPixels:Number(a.FullPanoHeightPixels)||0,fullPanoWidthPixels:Number(a.FullPanoWidthPixels)||0};if(a.croppedAreaImageWidthPixels&&b!==a.croppedAreaImageWidthPixels){b=b/a.croppedAreaImageWidthPixels;a.croppedAreaImageWidthPixels*=b;a.croppedAreaImageHeightPixels*=b;a.croppedAreaLeftPixels*=b;a.croppedAreaTopPixels*=b;a.fullPanoHeightPixels*=b;a.fullPanoWidthPixels*=b}return a}e.exports=a}),null);
__d("SphericalPhotoRenderer.redux",["cx","Promise","BootloadedComponent.react","Bootloader","CubemapImageTileProvider","DOM","EntPhotoCubemapTileUriProvider","Event","ImageUtils","JSResource","PhotoProjection","PhotoRendererProjection","React","ReactRedux","SphericalMediaBaseActions","SphericalMediaCanvasPool","SphericalMediaCoreActions","SphericalMediaRenderer.react","SphericalMediaViewActions","SphericalPhotoActions","SphericalPhotoPartialLimits","SphericalPhotoTypedConfig","StaticCubemapTileUriProvider","TiledCubeMapStereoGraphRenderer","TiledSphericalRenderer","getScaledPanoDimensions","joinClasses","performanceNow","uniqueID"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("ReactRedux").connect;var i=b("SphericalMediaBaseActions").setupRenderer,j=b("SphericalMediaBaseActions").sourceOnLoad,k=b("SphericalMediaBaseActions").updateBase,l=b("SphericalMediaBaseActions").viewportClicked,m=b("SphericalMediaBaseActions").webGlContextLost,n=b("SphericalMediaBaseActions").webGlInitFailed,o=b("SphericalMediaBaseActions").webGlRenderFailed,p=b("SphericalMediaCoreActions").turnOff,q=b("SphericalMediaViewActions").updateViewportAndFOV,r=b("SphericalPhotoActions").rendererStats,s=b("SphericalPhotoPartialLimits").makePartialLimits,t=2;d=babelHelpers.inherits(a,b("SphericalMediaRenderer.react"));h=d&&d.prototype;function a(a){h.constructor.call(this,a),this.$SphericalPhotoRenderer11=function(){this.draw(this.__getViewData())}.bind(this),this.__sourceElement=b("DOM").create("img"),this.$SphericalPhotoRenderer1=b("uniqueID")(),this.$SphericalPhotoRenderer2=0,this.$SphericalPhotoRenderer3=null}a.prototype.__afterDraw=function(){};a.prototype.__beforeCanvasLost=function(){this.$SphericalPhotoRenderer4(),this.sphericalRenderer&&this.sphericalRenderer.destroy(),this.sphericalRenderer=null,this.props.isActive&&this.props.dispatch(p())};a.prototype.__getViewData=function(){var a=this.props.viewStore.getState();a=a.view;return{fov:a.fov,pitch:a.pitch,yaw:a.yaw}};a.prototype.__getCanvas=function(){var a=this.$SphericalPhotoRenderer5();b("SphericalMediaCanvasPool").setLimit(t,a);var c={canvasAttrs:{width:this.props.width,height:this.props.height,className:b("joinClasses")(this.props.className,"_5nxw")},beforeCanvasLost:function(){return this.__beforeCanvasLost()}.bind(this)};return b("SphericalMediaCanvasPool").get(this.$SphericalPhotoRenderer1,c,a)};a.prototype.__onSetupDone=function(){this.$SphericalPhotoRenderer6()};a.prototype.__isReadyToSetup=function(){return this.props.isActive&&this.props.imageLoaded};a.prototype.__onFallbackUIClick=function(){this.props.dispatch(l())};a.prototype.__onWebGlRenderFailed=function(a,b){this.props.dispatch(o(a,b))};a.prototype.__onWebGlContextLost=function(){this.props.dispatch(m()),this.props.dispatch(p())};a.prototype.__onWebGlInitFailed=function(a){b("SphericalMediaCanvasPool").release(this.$SphericalPhotoRenderer1,this.props.canvasNamespace),this.props.dispatch(n(a)),this.props.dispatch(p())};a.prototype.$SphericalPhotoRenderer7=function(){var a=this.props.photoSphereMetadata,c=a.ProjectionType===b("PhotoProjection").EQUIRECTANGULAR;a=a.FullPanoWidthPixels===a.CroppedAreaImageWidthPixels&&a.FullPanoHeightPixels===a.CroppedAreaImageHeightPixels;return b("SphericalPhotoTypedConfig").enable_stereograph_renderer&&c&&a};a.prototype.__getRenderer=function(a){__p&&__p();return new(b("Promise"))(function(c,d){__p&&__p();var e=this.props,f=e.projectionType,g=e.photoSphereMetadata;if(this.props.tiledSphericalConfig.useTiledRenderer){e=this.$SphericalPhotoRenderer7()?b("TiledCubeMapStereoGraphRenderer"):b("TiledSphericalRenderer");if(this.__cubemapImageTileProvider)c(new e(a,this.__cubemapImageTileProvider,this.props.partialLimits,g.ProjectionType===b("PhotoProjection").CYLINDRICAL));else throw new Error("No __cubemapImageTileProvider")}else{if(!this.props.imageLoaded)throw new Error("__getRenderer was called before the source has been loaded.");var h=b("getScaledPanoDimensions")(g,this.__sourceElement.width);f===b("PhotoProjection").EQUIRECTANGULAR?b("Bootloader").loadModules(["EquirectSphericalWebGLRenderer"],function(b){try{c(new b(this.__sourceElement,a,babelHelpers["extends"]({poseHeadingDegrees:Number(g.PoseHeadingDegrees)||0,posePitchDegrees:Number(g.PosePitchDegrees)||0,poseRollDegrees:Number(g.PoseRollDegrees)||0},h)))}catch(a){d(a)}}.bind(this),"SphericalPhotoRenderer.redux"):f===b("PhotoProjection").CYLINDRICAL?b("Bootloader").loadModules(["CylindricalSphericalWebGLRenderer"],function(b){try{c(new b(this.__sourceElement,a,h))}catch(a){d(a)}}.bind(this),"SphericalPhotoRenderer.redux"):b("Bootloader").loadModules(["CubestripSphericalWebGLRenderer"],function(b){try{c(new b(this.__sourceElement,a))}catch(a){d(a)}}.bind(this),"SphericalPhotoRenderer.redux")}}.bind(this))};a.prototype.__destroy=function(){this.$SphericalPhotoRenderer4(),this.$SphericalPhotoRenderer3&&this.$SphericalPhotoRenderer3(),h.__destroy.call(this),b("SphericalMediaCanvasPool").release(this.$SphericalPhotoRenderer1,this.$SphericalPhotoRenderer5()),this.__sourceElement=b("DOM").create("img"),this.__cubemapImageTileProvider=null,this.props.dispatch(k({loaded:!1}))};a.prototype.$SphericalPhotoRenderer5=function(){var a,c;this.props.tiledSphericalConfig.useTiledRenderer?a=b("PhotoProjection").TILED_CUBEMAP:this.props.photoSphereMetadata.ProjectionType?a=this.props.photoSphereMetadata.ProjectionType:a=b("PhotoProjection").CUBESTRIP;this.$SphericalPhotoRenderer7()?c=b("PhotoRendererProjection").STEREOGRAPHIC:c=b("PhotoRendererProjection").PERSPECTIVE;return a+c+this.props.canvasNamespace};a.prototype.__showLoadingThumbnail=function(){return!this.props.taggingMode};a.prototype.$SphericalPhotoRenderer4=function(){var a=this.sphericalRenderer;if(a){a={avg_frame_render_time:a.getAverageFrameRenderTimeMillis(),avg_texture_to_screen_ratio2:a.getAverageTextureToScreenPixelRatio(),device_pixel_ratio:window.devicePixelRatio||1,dt:a.getTimeSinceFirstRenderMillis(),max_gpu_memory_used:a.getMaxGPUMemoryUsedBytes(),max_tile_level:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getMaxTileLevel():null,render_method:this.props.tiledSphericalConfig.useTiledRenderer?"tiled":"cubestrip",total_data_loaded:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getTotalPixelsLoaded():this.$SphericalPhotoRenderer8(),viewport_height:this.props.height,viewport_width:this.props.width};this.props.dispatch(r(a))}};a.prototype.$SphericalPhotoRenderer8=function(){if(this.__sourceElement&&b("ImageUtils").hasLoaded(this.__sourceElement)){var a=this.__sourceElement,c=a.width;a=a.height;return c*a}return 0};a.prototype.$SphericalPhotoRenderer9=function(a){var c=this.props.dispatch;b("DOM").setAttributes(this.__sourceElement,{crossOrigin:"anonymous",src:a});if(b("ImageUtils").hasLoaded(this.__sourceElement))c(j());else var d=b("Event").listen(this.__sourceElement,"load",function(){c(j()),d.remove()})};a.prototype.$SphericalPhotoRenderer10=function(){var a=this.props,c=a.dispatch;a=a.tiledSphericalConfig;if(a.useTiledRenderer&&!this.__cubemapImageTileProvider){a=this.props.fbid==="0"?new(b("StaticCubemapTileUriProvider"))(this.props.tiledSphericalConfig.initialTileUris):new(b("EntPhotoCubemapTileUriProvider"))(this.props.fbid,this.props.tiledSphericalConfig.initialTileUris);a=new(b("CubemapImageTileProvider"))(a,this.props.tiledSphericalConfig.maxTileLevel,this.props.tiledSphericalConfig.viewportTileUris);a.addBaseLevelReadyCallback(function(){return c(j())});this.__cubemapImageTileProvider=a}};a.prototype.$SphericalPhotoRenderer6=function(){this.$SphericalPhotoRenderer3=this.props.viewStore.subscribe(this.$SphericalPhotoRenderer11);this.draw(this.__getViewData());var a=this.sphericalRenderer;if(a){var c=b("performanceNow")()-this.$SphericalPhotoRenderer2;this.props.dispatch(i(a,c))}};a.prototype.componentDidMount=function(){var a=this.props.tiledSphericalConfig.useTiledRenderer;a?this.$SphericalPhotoRenderer10():this.props.cubeStripImageURI&&this.$SphericalPhotoRenderer9(this.props.cubeStripImageURI);this.props.isActive&&(this.$SphericalPhotoRenderer2=b("performanceNow")());h.componentDidMount.call(this)};a.prototype.UNSAFE_componentWillReceiveProps=function(a){__p&&__p();this.shouldRender=a.isActive&&!this.props.renderer||a.isActive!==this.props.isActive||a.thumbnail!==this.props.thumbnail||a.useFallbackUI!==this.props.useFallbackUI||a.width!==this.props.width||a.height!==this.props.height||a.imageLoaded&&!this.props.imageLoaded||a.renderer!==this.props.renderer;if(this.props.fbid!==a.fbid){this.shouldRender=!1;this.__destroy();return}a.isActive&&a.isActive!==this.props.isActive&&(this.$SphericalPhotoRenderer2=b("performanceNow")());this.props.renderer&&a.projectionType!==this.props.projectionType&&this.__destroy();var c=this.props.tiledSphericalConfig.useTiledRenderer;c?this.$SphericalPhotoRenderer10():a.cubeStripImageURI&&!this.__sourceElement.src&&this.$SphericalPhotoRenderer9(a.cubeStripImageURI);h.UNSAFE_componentWillReceiveProps.call(this,a)};a.prototype.componentWillUnmount=function(){this.props.viewStore.dispatch(q(this.props.initialYaw,this.props.initialPitch,this.props.initialFov)),h.componentWillUnmount.call(this)};a.prototype.render=function(){return this.props.useFallbackUI?b("React").createElement("div",{onClick:function(){return this.__onFallbackUIClick()}.bind(this),role:"link",tabIndex:"0",className:"_kp_"},b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoFallbackCanvasWrapper.redux").__setRef("SphericalPhotoRenderer.redux"),bootloadPlaceholder:b("React").createElement("span",null)})):h.render.call(this)};a.__subClassMethods={__afterDraw:!0,__beforeCanvasLost:!0,__getCanvas:!0,__getRenderer:!0,__getViewData:!0,__onSetupDone:!0,__isReadyToSetup:!0,__onFallbackUIClick:!0,__showLoadingThumbnail:!0,__onWebGlContextLost:!0,__onWebGlInitFailed:!0,__onWebGlRenderFailed:!0};f=function(a){return{className:a.base.className,expansionCoef:a.base.expansionCoef,height:a.base.height,initialFov:a.base.initialFov,initialPitch:a.base.initialPitch,initialYaw:a.base.initialYaw,isActive:a.base.isRendererActive||a.base.showFallbackUI,projectionType:a.base.projectionType,renderer:a.base.renderer,tiledSphericalConfig:a.base.tiledSphericalConfig,width:a.base.width,partialLimits:s({partialLeftDegrees:a.base.partialLimits.partialLeftDegrees,partialRightDegrees:a.base.partialLimits.partialRightDegrees,partialBottomDegrees:a.base.partialLimits.partialBottomDegrees,partialTopDegrees:a.base.partialLimits.partialTopDegrees}),fbid:a.base.fbid,isFetchingData:a.base.isFetchingData,imageLoaded:a.base.loaded,cubeStripImageURI:a.base.src,useFallbackUI:a.base.useFallbackUI,taggingMode:a.base.taggingMode,thumbnail:a.base.thumbnail,canvasNamespace:a.base.canvasNamespace,src:a.base.src,photoSphereMetadata:a.base.photoSphereMetadata,viewStore:a.base.viewStore}};e.exports=c(f)(a)}),null);
__d("SphericalPhotoStore",["SphericalMediaBaseReducer","SphericalMediaBaseStore"],(function(a,b,c,d,e,f){"use strict";var g;g=babelHelpers.inherits(a,b("SphericalMediaBaseStore"));g&&g.prototype;a.prototype.getReducers=function(){return{base:b("SphericalMediaBaseReducer")}};function a(){g.apply(this,arguments)}e.exports=a}),null);
__d("SphericalPhotoFeedEvents",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({DRAG_START:0,VIEWPORT_CLICKED:1,TAP_HEADING_INDICATOR:2})}),null);
__d("SphericalPhotoViewerLoggingMiddleware",["Banzai","Bootloader","SphericalMediaActions","SphericalPhotoConstants","SphericalPhotoFeedEvents","SphericalPhotoTypedConfig","collectDataAttributes","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalPhotoConstants").FEED_TRACKING_KEY,h=Object.freeze({NEWSSTAND:"newsstand"}),i=Object.freeze({CONTENT_CLICK:175}),j=b("immutable").List(),k=function(a,c,d){var e;a=b("collectDataAttributes")(a,["ft"]);c={ft:babelHelpers["extends"]((e={},e[g]=c,e),a.ft?a.ft:{})};d&&(c.ft.evt=d);b("Banzai").post("feed_tracking",c,{})};a=function(a){__p&&__p();var c=a.getState,d,e;b("SphericalPhotoTypedConfig").www_can_viewer_tag?b("Bootloader").loadModules(["SphericalPhotoViewerLoggingUtil","SphericalPhotoTagLoggingUtil"],function(a,b){d=a,e=b,j.forEach(function(a){d&&d.log(a.action,a.base),e&&e.log(a.action,a.base)}),j=j.clear()},"SphericalPhotoViewerLoggingMiddleware"):b("Bootloader").loadModules(["SphericalPhotoViewerLoggingUtil"],function(a){d=a,j.forEach(function(a){d&&d.log(a.action,a.base)}),j=j.clear()},"SphericalPhotoViewerLoggingMiddleware");return function(a){__p&&__p();return function(f){var g=c();d?(d.log(f,g.base),e&&e.log(f,g.base)):j=j.push({action:f,base:g.base});if(g.base.surface===h.NEWSSTAND&&g.base.ctrElement)switch(f.type){case b("SphericalMediaActions").TAP_HEADING_INDICATOR:k(g.base.ctrElement,b("SphericalPhotoFeedEvents").TAP_HEADING_INDICATOR);break;case b("SphericalMediaActions").DRAG_START:k(g.base.ctrElement,b("SphericalPhotoFeedEvents").DRAG_START,i.CONTENT_CLICK);break}return a(f)}}};e.exports=a}),null);
__d("SphericalPhotoViewerWrapper.redux",["cx","BootloadedComponent.react","JSResource","React","ReactRedux"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("ReactRedux").connect;h=babelHelpers.inherits(a,b("React").Component);h&&h.prototype;a.prototype.render=function(){return b("React").createElement("div",{className:"_3o6m _5nxw sphericalPhotoWrapper"},this.props.children,this.props.showFallbackUI?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoFallbackIndicator.redux").__setRef("SphericalPhotoViewerWrapper.redux"),bootloadPlaceholder:b("React").createElement("span",null)}):null)};function a(){h.apply(this,arguments)}d=function(a){return{showFallbackUI:a.base.showFallbackUI}};e.exports=c(d)(a)}),null);
__d("CubestripSphericalWebGLRenderer",["invariant","BaseRotatableWebGLRenderer","DOM"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=babelHelpers.inherits(a,b("BaseRotatableWebGLRenderer"));h=c&&c.prototype;function a(a,b,c,d){c===void 0&&(c=[]),d===void 0&&(d={}),h.constructor.call(this,b,d),this.__source=a,this.$CubestripSphericalWebGLRenderer2=0,this.__source&&this.__source.setAttribute("crossorigin","anonymous"),this.$CubestripSphericalWebGLRenderer6=null,this.$CubestripSphericalWebGLRenderer5=null,this.$CubestripSphericalWebGLRenderer4=c,this.__clearOnRender=!0,this.__setup()}a.prototype.__clearCache=function(){this.$CubestripSphericalWebGLRenderer1&&(this.__gl.deleteTexture(this.$CubestripSphericalWebGLRenderer1),this.$CubestripSphericalWebGLRenderer1=null)};a.prototype.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};a.prototype.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};a.prototype.__shaderProgramReady=function(){this.$CubestripSphericalWebGLRenderer7=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$CubestripSphericalWebGLRenderer7);var a=this.__gl.getUniformLocation(this.__shaderProgram,"uSampler");this.__gl.uniform1i(a,0)};a.prototype.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vVertexDirectionVector;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vVertexDirectionVector = aVertexPosition;\n      }\n    "};a.prototype.__getFragmentShaderScript=function(){return"\n      varying highp vec3 vVertexDirectionVector;\n      uniform samplerCube uSampler;\n\n      void main(void) {\n        gl_FragColor = textureCube(uSampler, vVertexDirectionVector);\n      }\n    "};a.prototype.__getMaxGPUMemoryUsedBytes=function(){return this.$CubestripSphericalWebGLRenderer2};a.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$CubestripSphericalWebGLRenderer3};a.prototype.__createTexture=function(){var a=this.__source;a||g(0,12371);this.__gl.activeTexture(this.__gl.TEXTURE0);this.$CubestripSphericalWebGLRenderer1||(this.$CubestripSphericalWebGLRenderer1=this.$CubestripSphericalWebGLRenderer8(a))};a.prototype.__renderInternal=function(){__p&&__p();this.__clearOnRender&&this.__gl.clear(this.__gl.COLOR_BUFFER_BIT|this.__gl.DEPTH_BUFFER_BIT);this.__createTexture();this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,this.$CubestripSphericalWebGLRenderer1);this.$CubestripSphericalWebGLRenderer6===null&&this.$CubestripSphericalWebGLRenderer9(0,0);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,this.$CubestripSphericalWebGLRenderer6);this.$CubestripSphericalWebGLRenderer6&&this.__gl.vertexAttribPointer(this.$CubestripSphericalWebGLRenderer7,this.$CubestripSphericalWebGLRenderer6.itemSize,this.__gl.FLOAT,!1,0,0);this.__gl.bindBuffer(this.__gl.ELEMENT_ARRAY_BUFFER,this.$CubestripSphericalWebGLRenderer5);this.$CubestripSphericalWebGLRenderer5&&this.__gl.drawElements(this.__gl.TRIANGLES,this.$CubestripSphericalWebGLRenderer5.numItems,this.__gl.UNSIGNED_SHORT,0);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);var a=this.$CubestripSphericalWebGLRenderer10(),b=this.__verticalFieldOfView;b=b/90*a;this.$CubestripSphericalWebGLRenderer3=b/this.__canvas.height};a.prototype.$CubestripSphericalWebGLRenderer9=function(a,b){__p&&__p();a=[5,1,3,7,0,4,6,2,6,7,3,2,0,1,5,4,4,5,7,6,1,0,2,3];b=[];for(var c=0;c<a.length;c++){var d=a[c]>>2&1,e=a[c]>>1&1,f=a[c]>>0&1;b.push(d*2-1);b.push(e*2-1);b.push(f*2-1)}this.$CubestripSphericalWebGLRenderer6=this.__gl.createBuffer();this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,this.$CubestripSphericalWebGLRenderer6);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(b),this.__gl.STATIC_DRAW);this.$CubestripSphericalWebGLRenderer6&&(this.$CubestripSphericalWebGLRenderer6.itemSize=3,this.$CubestripSphericalWebGLRenderer6.numItems=b.length/3);d=[];for(var e=0;e<a.length;e+=4)d.push(e),d.push(e+2),d.push(e+1),d.push(e),d.push(e+3),d.push(e+2);this.$CubestripSphericalWebGLRenderer5=this.__gl.createBuffer();this.__gl.bindBuffer(this.__gl.ELEMENT_ARRAY_BUFFER,this.$CubestripSphericalWebGLRenderer5);this.__gl.bufferData(this.__gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),this.__gl.STATIC_DRAW);this.$CubestripSphericalWebGLRenderer5&&(this.$CubestripSphericalWebGLRenderer5.itemSize=1,this.$CubestripSphericalWebGLRenderer5.numItems=d.length)};a.prototype.$CubestripSphericalWebGLRenderer10=function(){var a=this.__gl.getParameter(this.__gl.MAX_CUBE_MAP_TEXTURE_SIZE);return Math.min(a,this.__canvas.width)};a.prototype.$CubestripSphericalWebGLRenderer11=function(a){a=a*a*4*6;this.$CubestripSphericalWebGLRenderer2=Math.max(a,this.$CubestripSphericalWebGLRenderer2)};a.prototype.$CubestripSphericalWebGLRenderer8=function(a){__p&&__p();var c=this.__getNewGLTexObj(this.__gl.TEXTURE_CUBE_MAP),d=this.$CubestripSphericalWebGLRenderer10();this.$CubestripSphericalWebGLRenderer11(d);var e=a.naturalWidth;this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,!1);this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,c);var f;if(this.$CubestripSphericalWebGLRenderer4.length===6)f=this.$CubestripSphericalWebGLRenderer4;else{f=[];for(var g=0;g<6;g++){var h=b("DOM").create("canvas",{width:d,height:d}),i=h.getContext("2d");i.drawImage(a,0,g*e,e,e,0,0,d,d);f.push(h)}this.emit("cubefaceTexturesComputed",f)}i=0;f.forEach(function(b,a){this.__gl.texImage2D(this.__gl.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,b),i=this.__gl.getError()}.bind(this));i!==0&&this.emit("renderingError",new Error("WebGL Error Code: "+i));this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,null);return c};a.__subClassMethods={__getFragmentShaderScript:!0,__getVertexShaderScript:!0,__getShaderPerspectiveMatrixUniformName:!0,__getShaderRotationMatrixUniformName:!0,__renderInternal:!0,__shaderProgramReady:!0,__getMaxGPUMemoryUsedBytes:!0,__getPrevFrameTextureScreenRatio:!0,__createTexture:!0,__clearCache:!0};e.exports=a}),null);
__d("SphericalPhotoVrWebGLRenderer",["invariant","CubestripSphericalWebGLRenderer","DOM","gl-matrix"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("gl-matrix").glMatrix,j=b("gl-matrix").mat4,k=100;a=babelHelpers.inherits(l,b("CubestripSphericalWebGLRenderer"));h=a&&a.prototype;l.getInstance=function(a){l.$SphericalPhotoVrWebGLRenderer1!=null&&l.$SphericalPhotoVrWebGLRenderer1.vrDevice()!=a&&(l.$SphericalPhotoVrWebGLRenderer1=null);if(l.$SphericalPhotoVrWebGLRenderer1==null){var c=b("DOM").create("canvas");l.$SphericalPhotoVrWebGLRenderer1=new l(a,c,{preserveDrawingBuffer:a.capabilities&&a.capabilities.hasExternalDisplay})}return l.$SphericalPhotoVrWebGLRenderer1};function l(a,b,c){__p&&__p();h.constructor.call(this,null,b,[],c);l.$SphericalPhotoVrWebGLRenderer1===null||g(0,11125);this.__clearOnRender=!1;this.__verticalFieldOfView=k;this.__horizontalFieldOfView=k;this.__vrDevice=a;this.__vrFrameData=new window.VRFrameData();this.__initialMatrix=j.create();a.depthNear=.1;a.depthFar=2e3;b=a.getEyeParameters("left");this.__canvas.width=b.renderWidth*2;this.__canvas.height=b.renderHeight}l.prototype.vrDevice=function(){return this.__vrDevice};l.prototype.canvas=function(){return this.__canvas};l.prototype.enterVr=function(a,b,c){this.__source=c,this.__source.setAttribute("crossorigin","anonymous"),this.__clearCache(),this.__createTexture(),j.identity(this.__initialMatrix),j.rotateX(this.__initialMatrix,this.__initialMatrix,-i.toRadian(b)),j.rotateY(this.__initialMatrix,this.__initialMatrix,i.toRadian(a))};l.prototype.exitVr=function(){this.__source=null,this.__gl.clear(this.__gl.COLOR_BUFFER_BIT|this.__gl.DEPTH_BUFFER_BIT)};l.prototype.renderVr=function(){__p&&__p();if(this.__contextLost||this.__destroyed)return;this.vrDevice().getFrameData(this.__vrFrameData);j.fromQuat(this.__rotationMatrix,this.__vrFrameData.pose.orientation);j.invert(this.__rotationMatrix,this.__rotationMatrix);j.multiply(this.__rotationMatrix,this.__rotationMatrix,this.__initialMatrix);this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,!1,this.__rotationMatrix);this.__gl.viewport(0,0,this.__canvas.width*.5,this.__canvas.height);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__vrFrameData.leftProjectionMatrix);this.__renderInternal();this.__gl.viewport(this.__canvas.width*.5,0,this.__canvas.width*.5,this.__canvas.height);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__vrFrameData.rightProjectionMatrix);this.__renderInternal()};l.$SphericalPhotoVrWebGLRenderer1=null;e.exports=l}),null);
__d("SphericalPhotoWebVrContianer.redux",["invariant","React","ReactRedux","SphericalMediaBaseActions","SphericalPhotoVrWebGLRenderer","WebVrContainer.react","WebVrDeviceManager","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("ReactRedux").connect;var i=b("SphericalMediaBaseActions").setVrDevice,j=b("SphericalMediaBaseActions").setVrIsPresenting;d=babelHelpers.inherits(a,b("React").Component);h=d&&d.prototype;function a(){var a,b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=(a=h.constructor).call.apply(a,[this].concat(d)),this.state={},b}a.prototype.componentDidUpdate=function(a,c){this.$1&&this.$1.setIsClientReady(this.props.vrRendererIsReady),this.props.vrRenderingSupported&&(this.$2||(this.$2=this.$3.bind(this)),this.$1&&(this.props.visibility?b("WebVrDeviceManager").getInstance().addDeviceReadyListner(this.$2):b("WebVrDeviceManager").getInstance().removeDeviceReadyListner(this.$2)))};a.prototype.$3=function(a){var b=this.$1;b||g(0,11296);if(a!==null){var c=a.getEyeParameters("left");b.setDeviceReady(!0,c.renderWidth,c.renderHeight)}else b.setDeviceReady(!1,0,0);this.props.dispatch(i(a))};a.prototype.render=function(){__p&&__p();return b("React").createElement(b("WebVrContainer.react"),{enterVrCallback:function(){__p&&__p();var a=b("SphericalPhotoVrWebGLRenderer").getInstance(this.props.vrDevice).canvas(),c={onVrEnter:function(){var b=this.$1;b||g(0,11297);b.setVrOn(a);this.props.dispatch(j(!0))}.bind(this),onVrExit:function(){var a=this.$1;a||g(0,11298);a.setVrOff();this.props.dispatch(j(!1))}.bind(this),vrAttributes:{},vrCanvas:a};b("promiseDone")(b("WebVrDeviceManager").getInstance().enterVr(c))}.bind(this),exitVrCallback:function(){b("promiseDone")(b("WebVrDeviceManager").getInstance().exitVr())},needsOverlay:!0,ref:function(a){return this.$1=a}.bind(this)})};f=function(a){return{visibility:a.base.visibility,vrDevice:a.base.vrDevice,vrRenderingSupported:a.base.vrRenderingSupported,vrRendererIsReady:a.base.vrRendererIsReady}};e.exports=c(f)(a)}),null);
__d("SphericalMediaVrDriver",["invariant","FBLogger"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function a(a){__p&&__p();this.$4=function(){__p&&__p();var a=this.vrDevice();a||g(0,11293);if(a&&a.isPresenting){this.$2=a.requestAnimationFrame(this.$4);try{this.$1.renderVr()}catch(a){var c=b("FBLogger")("SphericalMediaVrRender");a!=null&&(c=c.catching(a));c.warn(a)}a.submitFrame()}}.bind(this),this.$1=a,this.$3=!1,this.$2=null}a.prototype.vrDevice=function(){return this.$1.vrDevice()};a.prototype.enterVr=function(a,b,c){this.$3&&g(0,12378);var d=this.vrDevice();d||g(0,11294);this.$1.enterVr(a,b,c);this.$3=!0;this.$2=d.requestAnimationFrame(this.$4)};a.prototype.exitVr=function(){this.$3||g(0,12379);var a=this.vrDevice();a||g(0,11295);a.cancelAnimationFrame(this.$4);this.$2=null;this.$3=!1;this.$1.exitVr()};e.exports=a}),null);
__d("SphericalPhotoWebVrRenderer.redux",["invariant","DOM","Event","ImageUtils","React","ReactRedux","SphericalMediaBaseActions","SphericalMediaVrDriver","SphericalPhotoVrWebGLRenderer"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("ReactRedux").connect;var i=b("SphericalMediaBaseActions").setVrRendererIsReady,j=b("SphericalMediaBaseActions").setVrRenderingSupported;d=babelHelpers.inherits(a,b("React").Component);h=d&&d.prototype;function a(a){h.constructor.call(this,a),this.state={},this.$2=b("DOM").create("img"),this.$1=null}a.prototype.componentDidMount=function(){this.$3(),this.$4()};a.prototype.componentDidUpdate=function(a){a.fullscreenCubeImageURI!=this.props.fullscreenCubeImageURI&&this.$3();a.vrDevice!=this.props.vrDevice&&this.$4();if(this.props.vrIsPresenting===!0&&a.vrIsPresenting===!1){b("ImageUtils").hasLoaded(this.$2)||g(0,12381);var c=this.$1;c||g(0,12380);c.enterVr(this.props.initialYaw,0,this.$2)}else this.props.vrIsPresenting===!1&&a.vrIsPresenting===!0&&(this.$1||g(0,12380),this.$1.exitVr())};a.prototype.$3=function(){var a=this.props,c=a.fullscreenCubeImageURI,d=a.dispatch;if(c&&!this.$2.src){b("DOM").setAttributes(this.$2,{crossOrigin:"anonymous",src:c});if(!b("ImageUtils").hasLoaded(this.$2))var e=b("Event").listen(this.$2,"load",function(){this.$5(),e.remove(),d(i(!0))}.bind(this))}d(j(c!=null))};a.prototype.$5=function(){!this.$1&&this.props.vrDevice&&b("ImageUtils").hasLoaded(this.$2)&&(this.$1=new(b("SphericalMediaVrDriver"))(b("SphericalPhotoVrWebGLRenderer").getInstance(this.props.vrDevice)))};a.prototype.$4=function(){var a=this.props.vrDevice;this.$1!=null&&this.$1.vrDevice()!=a&&(this.$1=null);this.$1||this.$5()};a.prototype.render=function(){return b("React").createElement("div",null)};f=function(a){return{vrDevice:a.base.vrDevice,vrIsPresenting:a.base.vrIsPresenting,initialYaw:a.base.initialYaw,fullscreenCubeImageURI:a.base.fullscreenCubeImageURI}};e.exports=c(f)(a)}),null);
__d("SphericalPhotoViewer.react",["BootloadedComponent.react","ImmersiveMediaOverlay.react","JSResource","PhotoProjection","React","ReactRedux","SphericalMediaBaseActions","SphericalMediaCoreActions","SphericalMediaViewActions","SphericalPhotoController.redux","SphericalPhotoFallbackMiddleware","SphericalPhotoPartialLimits","SphericalPhotoRenderer.redux","SphericalPhotoStore","SphericalPhotoTypedConfig","SphericalPhotoViewerLoggingMiddleware","SphericalPhotoViewerWrapper.redux","SphericalPhotoWebVrContianer.redux","SphericalPhotoWebVrRenderer.redux","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("ReactRedux").Provider,i=b("SphericalMediaBaseActions").updateBase,j=b("SphericalMediaBaseActions").updateDimension,k=b("SphericalMediaCoreActions").turnOff,l=b("SphericalMediaCoreActions").turnOn,m=b("SphericalMediaViewActions").updateView,n=b("SphericalPhotoPartialLimits").makePartialLimits;c=babelHelpers.inherits(a,b("React").Component);g=c&&c.prototype;function a(a){g.constructor.call(this,a),this.__store=new(b("SphericalPhotoStore"))(this.__getMiddleware()).getStore()}a.prototype.shouldComponentUpdate=function(a){return this.props.caption!==a.caption||this.props.cubeImageURI!==a.cubeImageURI||this.props.enableTagging!==a.enableTagging||this.props.height!==a.height||this.props.initialImageURI!==a.initialImageURI||this.props.photoID!==a.photoID||this.props.surface!==a.surface||this.props.fullscreenCubeImageURI!==a.fullscreenCubeImageURI||this.props.width!==a.width};a.prototype.componentWillUnmount=function(){this.__store.dispatch(k())};a.prototype.UNSAFE_componentWillMount=function(){this.__updateState(),this.__store.dispatch(l())};a.prototype.componentDidUpdate=function(){this.__updateState(this.props)};a.prototype.UNSAFE_componentWillReceiveProps=function(a){a.photoID!==this.__store.getState().base.fbid&&this.__updateState(a)};a.prototype.__getMiddleware=function(){var a=this.props.middlewares||[];return a.concat([b("SphericalPhotoViewerLoggingMiddleware"),b("SphericalPhotoFallbackMiddleware")])};a.prototype.__updateState=function(a){a===void 0&&(a=this.props);var c={enableGyro:a.enableGyro,enableZoom:a.enableZoom,enableRubberBanding:a.enableRubberBanding,visibility:!0},d,e,f,g;a.partialLimits&&(d=a.partialLimits.partialLeftDegrees,e=a.partialLimits.partialRightDegrees,f=a.partialLimits.partialBottomDegrees,g=a.partialLimits.partialTopDegrees);this.__store.dispatch(i(babelHelpers["extends"]({ambientAudio:a.ambientAudio||[],enableTagging:b("SphericalPhotoTypedConfig").www_can_viewer_tag&&a.enableTagging,initialYaw:a.initialView.yaw,initialPitch:a.initialView.pitch,initialFov:a.initialView.fov,tiledSphericalConfig:a.tiledSphericalConfig,caption:a.caption,canvasNamespace:a.canvasNamespace,fallback:a.fallback,fbid:a.photoID,partialLimits:n({partialLeftDegrees:d,partialRightDegrees:e,partialBottomDegrees:f,partialTopDegrees:g}),projectionType:a.projectionType,photoSphereMetadata:a.photoSphereMetadata||{},src:a.cubeImageURI,surface:a.surface,thumbnail:a.initialImageURI||"",useLargeHeadingIndicator:a.useLargeHeadingIndicator||!1,useLargeVolumeIcon:a.useLargeVolumeIcon||!1,fullscreenCubeImageURI:a.fullscreenCubeImageURI},c)));this.__store.dispatch(j(a.width,a.height));c=this.__store.getState().base.viewStore;c.dispatch(m({yaw:a.initialView.yaw,pitch:a.initialView.pitch,fov:a.initialView.fov}))};a.prototype.render=function(){var a=b("gkx")("728105"),c=a?b("React").createElement(b("SphericalPhotoWebVrContianer.redux"),null):null;a=a?b("React").createElement(b("SphericalPhotoWebVrRenderer.redux"),null):null;return b("React").createElement(h,{store:this.__store},b("React").createElement(b("SphericalPhotoViewerWrapper.redux"),null,c,a,b("React").createElement(b("SphericalPhotoRenderer.redux"),null),this.__store.getState().base.enableTagging?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoTagging.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null,b("React").createElement(b("SphericalPhotoController.redux"),null),b("gkx")("764274")&&b("React").createElement(b("ImmersiveMediaOverlay.react"),{graphQLID:this.props.graphQLID}),b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoHeadingIndicator.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}),this.props.ambientAudio&&this.props.ambientAudio.length>0?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoVolumeControl.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null,this.props.showMouseAnimation?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalMediaMouseOverlay.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null,this.props.showGyroAnimation?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalMediaGyroOverlay.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null,this.props.showManager?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoManagerLoader").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null))};a.defaultProps={canvasNamespace:"PhotoViewer",enableGyro:!1,enableRubberBanding:!1,enablevisibilityObserver:!1,enableZoom:!1,projectionType:b("PhotoProjection").CUBESTRIP,showGyroAnimation:!1,showManager:!1,showMouseAnimation:!0,useLargeHeadingIndicator:!1,useLargeVolumeIcon:!1};e.exports=a}),null);
__d("SphericalPhotoViewerInFeed.react",["cx","Arbiter","Bootloader","CSS","DataStore","Event","ReactDOM","SphericalMediaActions","SphericalMediaBaseActions","SphericalMediaCoreActions","SphericalMediaViewActions","SphericalParallaxUtils","SphericalPhotoTypedConfig","SphericalPhotoViewer.react","SubscriptionsHandler","debounce","getElementRect","getViewportDimensions","onViewportChanged"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("SphericalMediaBaseActions").updateFeedRootElement,j=b("SphericalMediaBaseActions").visibilityChanged,k=b("SphericalMediaCoreActions").turnOff,l=b("SphericalMediaCoreActions").turnOn,m=b("SphericalMediaViewActions").updateYaw,n=b("SphericalParallaxUtils").calculateNewYaw,o=5e3,p=50;c=babelHelpers.inherits(a,b("SphericalPhotoViewer.react"));h=c&&c.prototype;function a(a){__p&&__p();h.constructor.call(this,a);this.$SphericalPhotoViewerInFeed16=function(){if(this.$SphericalPhotoViewerInFeed20())return;if(this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.isOpen)return;var a=b("getViewportDimensions").withoutScrollbars();a=a.height;this.$SphericalPhotoViewerInFeed21(a,0);this.$SphericalPhotoViewerInFeed17();this.__store.dispatch(l())}.bind(this);this.$SphericalPhotoViewerInFeed15=b("debounce")(function(a){if(!this.$SphericalPhotoViewerInFeed5)return;var c=b("getElementRect")(this.$SphericalPhotoViewerInFeed5),d=a.bottom-a.top,e=c.bottom-c.top;d=(d-e)/3;e=a.top+d;a=a.bottom-d;d=c.top>e&&c.top<a||c.bottom>e&&c.bottom<a||e>c.top&&a<c.bottom;this.$SphericalPhotoViewerInFeed3!==d&&(this.$SphericalPhotoViewerInFeed3=d,d?this.$SphericalPhotoViewerInFeed22():this.$SphericalPhotoViewerInFeed23())}.bind(this),p);this.$SphericalPhotoViewerInFeed18=function(a){this.$SphericalPhotoViewerInFeed21(a.bottom,a.top)}.bind(this);if(a.initialViewElement&&b("SphericalPhotoTypedConfig").reuse_dom_data_in_snowlift){a=a.initialViewElement.children[0];a&&a instanceof HTMLImageElement&&b("DataStore").set(a,"sphericalPhotoData",{url:a.src,smallurl:a.src,cubeImageURI:this.props.cubeImageURI,fullscreenCubeImageURI:this.props.fullscreenCubeImageURI,tiledSphericalConfig:this.props.tiledSphericalConfig,initialView:this.props.initialView,dimensions:{x:this.props.width,y:this.props.height},partialLimits:this.props.partialLimits,fbid:this.props.photoID,photoSphereMetadata:this.props.photoSphereMetadata,fallback:this.props.fallback,ambientAudio:this.props.ambientAudio})}}a.prototype.__getMiddleware=function(){__p&&__p();var a=h.__getMiddleware.call(this),c=function(){return function(a){return function(c){if(c.type===b("SphericalMediaActions").VIEWPORT_CLICKED){var d=this.props.externalLinkElement||this.props.theaterLinkElement;d&&d.click()}return a(c)}.bind(this)}.bind(this)}.bind(this),d=function(a){var c=a.getState;return function(a){return function(d){var e=c().base.showFallbackUI;e||(d.type===b("SphericalMediaActions").TURN_ON&&this.$SphericalPhotoViewerInFeed12(),(d.type===b("SphericalMediaActions").SETUP_RENDERER||d.type===b("SphericalMediaActions").SHOW_FALLBACK)&&(this.$SphericalPhotoViewerInFeed13(),this.props.initialViewElement&&b("CSS").hide(this.props.initialViewElement)));return a(d)}.bind(this)}.bind(this)}.bind(this),e=function(a){var c=a.getState;return function(a){return function(d){var e=c().base.showFallbackUI;e||d.type===b("SphericalMediaActions").TURN_OFF&&(this.$SphericalPhotoViewerInFeed3=!1,b("CSS").show(this.props.loadingElement),this.$SphericalPhotoViewerInFeed14(),this.props.initialViewElement&&b("CSS").show(this.props.initialViewElement));return a(d)}.bind(this)}.bind(this)}.bind(this);return a.concat([c,d,e])};a.prototype.componentDidMount=function(){__p&&__p();this.__updateState();this.__store.dispatch(j(!1));this.$SphericalPhotoViewerInFeed14();var a=b("onViewportChanged")(this.$SphericalPhotoViewerInFeed15);this.$SphericalPhotoViewerInFeed1=b("Arbiter").subscribe("PhotoSnowlift.CLOSE",function(){this.$SphericalPhotoViewerInFeed3=!1,a.scheduleCheck()}.bind(this));this.$SphericalPhotoViewerInFeed2=b("Arbiter").subscribe("PhotoSnowlift.OPEN",function(){this.__store.dispatch(j(!1)),b("Bootloader").loadModules(["PhotoSnowlift"],function(a){this.$SphericalPhotoViewerInFeed7=a.getInstance()}.bind(this),"SphericalPhotoViewerInFeed.react")}.bind(this));this.$SphericalPhotoViewerInFeed3=!1;var c=new(b("SubscriptionsHandler"))(),d=b("ReactDOM").findDOMNode(this);this.__store.dispatch(i(d));c.addSubscriptions(b("Event").listen(d,"mouseenter",this.$SphericalPhotoViewerInFeed16),b("Event").listen(d,"touchstart",this.$SphericalPhotoViewerInFeed16));a.scheduleCheck();this.$SphericalPhotoViewerInFeed4=a;this.$SphericalPhotoViewerInFeed6=c;this.$SphericalPhotoViewerInFeed5=d;this.$SphericalPhotoViewerInFeed9=50;this.$SphericalPhotoViewerInFeed10=0;this.$SphericalPhotoViewerInFeed17();b("onViewportChanged")(this.$SphericalPhotoViewerInFeed18)};a.prototype.UNSAFE_componentWillMount=function(){this.__updateState()};a.prototype.componentWillUnmount=function(){this.$SphericalPhotoViewerInFeed19(),this.$SphericalPhotoViewerInFeed5=null,h.componentWillUnmount.call(this)};a.prototype.$SphericalPhotoViewerInFeed19=function(){this.$SphericalPhotoViewerInFeed1&&(b("Arbiter").unsubscribe(this.$SphericalPhotoViewerInFeed1),this.$SphericalPhotoViewerInFeed1=null),this.$SphericalPhotoViewerInFeed2&&(b("Arbiter").unsubscribe(this.$SphericalPhotoViewerInFeed2),this.$SphericalPhotoViewerInFeed2=null),this.$SphericalPhotoViewerInFeed4&&this.$SphericalPhotoViewerInFeed4.remove(),this.$SphericalPhotoViewerInFeed4=null,this.$SphericalPhotoViewerInFeed6&&this.$SphericalPhotoViewerInFeed6.release(),this.$SphericalPhotoViewerInFeed6=null};a.prototype.$SphericalPhotoViewerInFeed12=function(){b("CSS").addClass(this.props.loadingElement,"_2dz7"),b("CSS").removeClass(this.props.loadingElement,"_3s0i")};a.prototype.$SphericalPhotoViewerInFeed14=function(){b("CSS").removeClass(this.props.loadingElement,"_2dz7"),b("CSS").addClass(this.props.loadingElement,"_3s0i")};a.prototype.$SphericalPhotoViewerInFeed13=function(){b("CSS").removeClass(this.props.loadingElement,"_2dz7"),window.setTimeout(function(){b("CSS").hide(this.props.loadingElement)}.bind(this),300)};a.prototype.$SphericalPhotoViewerInFeed20=function(){return this.__store.getState().base.isRendererActive};a.prototype.$SphericalPhotoViewerInFeed21=function(a,c){if(this.$SphericalPhotoViewerInFeed3){if(!this.$SphericalPhotoViewerInFeed5)return;var d=b("getElementRect")(this.$SphericalPhotoViewerInFeed5);d=d.top+d.bottom/2;this.$SphericalPhotoViewerInFeed8=d/(a-c)*100;this.$SphericalPhotoViewerInFeed11||this.$SphericalPhotoViewerInFeed17()}};a.prototype.$SphericalPhotoViewerInFeed17=function(){__p&&__p();if(this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.isOpen)return;if(this.$SphericalPhotoViewerInFeed8!==void 0){this.$SphericalPhotoViewerInFeed11=!0;var a=this.__store.getState().base,b=a.viewStore,c=a.aspectRatio;a=a.partialLimits;var d=b.getState().view,e=d.fov;d=d.centeredYaw;if(d!==this.$SphericalPhotoViewerInFeed10){this.$SphericalPhotoViewerInFeed9=this.$SphericalPhotoViewerInFeed8;this.$SphericalPhotoViewerInFeed10=d;this.$SphericalPhotoViewerInFeed11=!1;return}window.requestAnimationFrame(function(){return this.$SphericalPhotoViewerInFeed17()}.bind(this));(this.$SphericalPhotoViewerInFeed8<-100||this.$SphericalPhotoViewerInFeed8>200)&&(this.$SphericalPhotoViewerInFeed9=50);d=e*c/2;e=n(this.$SphericalPhotoViewerInFeed8,this.$SphericalPhotoViewerInFeed9,this.$SphericalPhotoViewerInFeed10,a.partialLeftDegrees,a.partialRightDegrees,d);c=e.yaw;a=e.success;if(a){d=b.getState().view.yaw;c!==d&&b.dispatch(m(c))}}};a.prototype.$SphericalPhotoViewerInFeed23=function(){this.$SphericalPhotoViewerInFeed14(),window.setTimeout(function(){!this.$SphericalPhotoViewerInFeed3&&this.$SphericalPhotoViewerInFeed20()&&this.__store.dispatch(k())}.bind(this),o),this.__store.dispatch(j(!1))};a.prototype.$SphericalPhotoViewerInFeed22=function(){this.$SphericalPhotoViewerInFeed16(),this.__store.dispatch(j(!0))};e.exports=a}),null);