if (self.CavalryLogger) { CavalryLogger.start_js(["jY\/6T"]); }

__d("SphericalMediaTagging.react",["cx","React","SphericalMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("SphericalMediaUtils").getDPR;h=babelHelpers.inherits(a,b("React").Component);h&&h.prototype;a.prototype.componentDidMount=function(){this.$2(this.props.width,this.props.height)};a.prototype.UNSAFE_componentWillReceiveProps=function(a){(this.props.width!==a.width||this.props.height!==a.height)&&this.$2(a.width,a.height)};a.prototype.componentDidUpdate=function(a){this.draw(this.__getViewData())};a.prototype.draw=function(a){if(!this.$1)return;var b=this.$1,c=b.getContext("2d");if(!c)return;c.clearRect(0,0,b.width,b.height);this.props.taggingMode?this.__drawTaggingModeElements(c,a):this.__drawViewingModeElements(c,a);this.__drawCommonElements(c,a)};a.prototype.$2=function(a,b){if(!this.$1)return;var c=this.$1,d=c.getContext("2d");if(!d)return;d.clearRect(0,0,a,b);c.width=a*i();c.height=b*i()};a.prototype.render=function(){return this.props.isActive?b("React").createElement("canvas",{className:"_2xob _5nxw",ref:function(a){return this.$1=a}.bind(this)}):null};function a(){h.apply(this,arguments)}e.exports=a}),null);
__d("SphericalMediaTaggingCanvasElements",["SphericalMediaUtils"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalMediaUtils").getDPR,h=3.2,i=.8,j=1,k=5,l=7;a=Math.floor(l/2);var m=8,n=2,o=5,p=11,q=4,r={BORDER_WIDTH:j,TAG_ARROW_HEIGHT:k,TAG_ARROW_WIDTH:l,TAG_ARROW_WIDTH_HALF:a,TAG_SIDE_PADDING:m,TAG_TOP_PADDING:n,TAG_BOTTOM_PADDING:o,TAG_TEXT_HEIGHT:p,FACEBOX_EDGE_WIDTH:q,update:function(){__p&&__p();var a=g();r.BORDER_WIDTH=j*a;r.TAG_ARROW_HEIGHT=k*a;r.TAG_ARROW_WIDTH=l*a;r.TAG_ARROW_WIDTH_HALF=Math.floor(r.TAG_ARROW_WIDTH/2);r.TAG_SIDE_PADDING=m*a;r.TAG_TOP_PADDING=n*a;r.TAG_BOTTOM_PADDING=o*a;r.TAG_TEXT_HEIGHT=p*a;r.FACEBOX_EDGE_WIDTH=q*a}};c={drawTag:function(a,b,c,d){__p&&__p();var e=c.x;c=c.y+d.h/2;r.update();a.font=r.TAG_TEXT_HEIGHT+"px sans-serif";d=this.calculateTagElementDrawPoints({x:e,y:c},a.measureText(b).width);a.fillStyle="white";a.strokeStyle="rgba(0, 0, 0, 0.25)";a.beginPath();a.moveTo(e,c);d.forEach(function(b){a.lineTo(b.x,b.y)});a.closePath();a.stroke();a.fill();a.fillStyle="#404040";a.textAlign="center";a.fillText(b,e,c+r.TAG_ARROW_HEIGHT+r.TAG_TEXT_HEIGHT+r.TAG_TOP_PADDING+r.BORDER_WIDTH)},calculateTagElementDrawPoints:function(a,b){if(b<0)return[];r.update();b=b+r.TAG_SIDE_PADDING*2;return[{x:a.x+r.TAG_ARROW_WIDTH_HALF+r.BORDER_WIDTH,y:a.y+r.TAG_ARROW_HEIGHT-r.BORDER_WIDTH},{x:a.x+b/2+r.BORDER_WIDTH,y:a.y+r.TAG_ARROW_HEIGHT-r.BORDER_WIDTH},{x:a.x+b/2+r.BORDER_WIDTH,y:a.y+r.TAG_ARROW_HEIGHT+r.TAG_TEXT_HEIGHT+r.TAG_TOP_PADDING+r.TAG_BOTTOM_PADDING+r.BORDER_WIDTH},{x:a.x-b/2-r.BORDER_WIDTH,y:a.y+r.TAG_ARROW_HEIGHT+r.TAG_TEXT_HEIGHT+r.TAG_TOP_PADDING+r.TAG_BOTTOM_PADDING+r.BORDER_WIDTH},{x:a.x-b/2-r.BORDER_WIDTH,y:a.y+r.TAG_ARROW_HEIGHT-r.BORDER_WIDTH},{x:a.x-r.TAG_ARROW_WIDTH_HALF-r.BORDER_WIDTH,y:a.y+r.TAG_ARROW_HEIGHT-r.BORDER_WIDTH}]},drawFacebox:function(a,b,c,d){var e=b.x-c.w/2;b=b.y-c.h/2;(d<0||d>1)&&(d=i);a.strokeStyle="rgba(0, 0, 0, "+d/h+")";a.strokeRect.apply(a,this.calculateFaceboxElementBorderDrawPoints({x:e,y:b},c));r.update();a.strokeStyle="rgba(255, 255, 255, "+d+")";a.lineWidth=r.FACEBOX_EDGE_WIDTH;a.strokeRect(e,b,c.w,c.h)},calculateFaceboxElementBorderDrawPoints:function(a,b){if(b.w<0||b.h<0)return[];r.update();return[a.x-r.FACEBOX_EDGE_WIDTH/2-r.BORDER_WIDTH,a.y-r.FACEBOX_EDGE_WIDTH/2-r.BORDER_WIDTH,b.w+r.FACEBOX_EDGE_WIDTH+r.BORDER_WIDTH,b.h+r.FACEBOX_EDGE_WIDTH+r.BORDER_WIDTH]}};e.exports=c}),null);
__d("SphericalPhotoTagging.redux",["ReactRedux","SphericalMediaConstants","SphericalMediaTagging.react","SphericalMediaTaggingCanvasElements","SphericalMediaTaggingUtils","SphericalMediaUtils","SphericalMediaViewportAnimation","SphericalPhotoPartialLimits","SphericalPhotoProjectionUtils","SphericalPhotoTypedConfig","SphericalProjectionUtils","debounce"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=b("ReactRedux").connect;var h=b("SphericalMediaConstants").UNTAGGED_FACEBOX,i=b("SphericalMediaTaggingUtils").compareTags,j=b("SphericalMediaTaggingUtils").getSpatialTagArea,k=b("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer,l=b("SphericalMediaTaggingUtils").pointsToRectSize,m=b("SphericalMediaUtils").getDPR,n=b("SphericalMediaViewportAnimation").moveTo,o=b("SphericalPhotoPartialLimits").makePartialLimits,p=b("SphericalPhotoPartialLimits").normalizePhotoRendererViewWithPartialLimits,q=b("SphericalPhotoPartialLimits").normalizeViewWithPartialLimits;d=babelHelpers.inherits(a,b("SphericalMediaTagging.react"));g=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=g.constructor).call.apply(a,[this].concat(e)),this.$SphericalPhotoTagging1=function(){this.draw(this.__getViewData())}.bind(this),this.$SphericalPhotoTagging6=b("debounce")(function(a){__p&&__p();var c=this.__getViewData();c=c.fov;a=a.center;var d=a.pitch;a=a.yaw;var e=this.props,f=e.aspectRatio,g=e.tagger,h=e.partialLimits;e=e.showNewPhotoRenderer;g&&g.hideTagger();if(e){g=b("SphericalPhotoProjectionUtils").getPartialLimits(c,f,o({partialLeftDegrees:h.partialLeftDegrees,partialRightDegrees:h.partialRightDegrees,partialTopDegrees:h.partialTopDegrees,partialBottomDegrees:h.partialBottomDegrees}));this.props.viewStore.dispatch(n(p({fov:c,pitch:d,yaw:a},o(g))))}else this.props.viewStore.dispatch(n(q({fov:c,pitch:d,yaw:a},o({partialLeftDegrees:h.partialLeftDegrees,partialRightDegrees:h.partialRightDegrees,partialTopDegrees:h.partialTopDegrees,partialBottomDegrees:h.partialBottomDegrees}))))}.bind(this),500),c}a.prototype.componentDidMount=function(){g.componentDidMount.call(this),this.props.viewStore.subscribe(this.$SphericalPhotoTagging1)};a.prototype.UNSAFE_componentWillReceiveProps=function(a){g.UNSAFE_componentWillReceiveProps.call(this,a)};a.prototype.$SphericalPhotoTagging2=function(){var a=m();a={width:this.props.width*a,height:this.props.height*a};return a};a.prototype.$SphericalPhotoTagging3=function(a){var c=this.__getViewData(),d;if(this.props.showNewPhotoRenderer){var e=this.props.partialLimits;d=b("SphericalPhotoProjectionUtils").convert3dTo2d(a.center.yaw,a.center.pitch,c,this.$SphericalPhotoTagging2().width,this.$SphericalPhotoTagging2().height,e);e=k(a,this.__getViewData(),{w:this.$SphericalPhotoTagging2().width,h:this.$SphericalPhotoTagging2().height},e)}else d=b("SphericalProjectionUtils").convert3dTo2dScaledUnique(a.center.yaw,a.center.pitch,c.yaw,c.pitch,c.fov,this.$SphericalPhotoTagging2().width,this.$SphericalPhotoTagging2().height),e=j(a,this.__getViewData(),{w:this.$SphericalPhotoTagging2().width,h:this.$SphericalPhotoTagging2().height});c=l(e);return{tagPoint:d,boxSize:c}};a.prototype.$SphericalPhotoTagging4=function(a,c){var d=this.$SphericalPhotoTagging3(c),e=d.tagPoint;d=d.boxSize;if(e.x<0||e.y<0)return;b("SphericalMediaTaggingCanvasElements").drawTag(a,c.label,e,d)};a.prototype.$SphericalPhotoTagging5=function(a,c,d){c=this.$SphericalPhotoTagging3(c);var e=c.tagPoint;c=c.boxSize;if(e.x<0||e.y<0)return;b("SphericalMediaTaggingCanvasElements").drawFacebox(a,e,c,d)};a.prototype.__drawViewingModeElements=function(a,b){b=this.props;var c=b.tagClicked,d=b.isTagging,e=b.tagUnderMouse;b=b.tags;var f=!1,g=!1;(e||d)&&(c&&d&&((!f||f&&!i(e,c))&&(this.$SphericalPhotoTagging5(a,c,.4),g=!0)),e&&(e.type!==h?this.$SphericalPhotoTagging4(a,e):(!g||g&&!i(e,c))&&this.$SphericalPhotoTagging5(a,e,.4),f=!0),b.forEach(function(b){if(b.type!==h||f&&i(b,e)||g&&i(b,c))return;this.$SphericalPhotoTagging5(a,b,.2)}.bind(this)))};a.prototype.__drawTaggingModeElements=function(a,b){b=this.props;var c=b.tagClicked,d=b.tags,e=b.tagUnderMouse;d.forEach(function(b){var d=c===b?1:e===b?.8:.3;b.type!==h?e===b&&this.$SphericalPhotoTagging4(a,b):this.$SphericalPhotoTagging5(a,b,d)}.bind(this))};a.prototype.__drawCommonElements=function(a,b){b=this.props.targetedTag;b&&(this.$SphericalPhotoTagging6(b),this.$SphericalPhotoTagging5(a,b,.8))};a.prototype.__getViewData=function(){var a=this.props.viewStore.getState();a=a.view;return{fov:a.fov,pitch:a.pitch,yaw:a.yaw}};a.__subClassMethods={__drawTaggingModeElements:!0,__getViewData:!0,__drawViewingModeElements:!0,__drawCommonElements:!0};f=function(a){a=a.base;return{aspectRatio:a.aspectRatio,isActive:a.enableTagging,height:a.height,isTagging:a.isTagging,partialLimits:o({partialLeftDegrees:a.partialLimits.partialLeftDegrees,partialRightDegrees:a.partialLimits.partialRightDegrees,partialBottomDegrees:a.partialLimits.partialBottomDegrees,partialTopDegrees:a.partialLimits.partialTopDegrees}),tagClicked:a.tagClicked,taggingMode:a.taggingMode,tagger:a.tagger,tags:a.tags,tagUnderMouse:a.tagUnderMouse,targetedTag:a.targetedTag,showNewPhotoRenderer:a.tiledSphericalConfig.useTiledRenderer&&b("SphericalPhotoTypedConfig").show_new_renderer,viewStore:a.viewStore,width:a.width}};e.exports=c(f)(a)}),null);